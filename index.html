<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Goa Shadow Bazaar</title>
    <link rel="icon" type="image/png" href="images/mandala-icon.png">
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(45deg, #2b0a0a, #1a2b1a);
            font-family: 'Georgia', serif;
            color: #d4af37;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }
        .header {
            background: #4a0e0e url('images/fabric-texture.jpg');
            background: linear-gradient(45deg, #4a0e0e, #3c2f2f);
            padding: 15px;
            text-align: center;
            border-bottom: 3px solid #d4af37;
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.5);
            position: relative;
        }
        .logo {
            font-size: 32px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
            animation: glow 2s infinite;
        }
        @keyframes glow {
            0% { text-shadow: 0 0 5px #d4af37; }
            50% { text-shadow: 0 0 15px #d4af37, 0 0 25px #ff8c00; }
            100% { text-shadow: 0 0 5px #d4af37; }
        }
        .header-text {
            font-size: 14px;
            color: #e0d0b0;
            position: relative;
            display: inline-block;
        }
        .language-switcher {
            position: absolute;
            top: 50px; /* Сдвигаем ещё ниже */
            right: 15px;
        }
        .language-button {
            background: linear-gradient(45deg, #d4af37, #ff8c00);
            color: #2b0a0a;
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 5px;
            transition: transform 0.3s;
        }
        .language-button:hover {
            transform: scale(1.05);
        }
        .nav {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 10px 0;
            background: rgba(0, 0, 0, 0.7);
            flex-wrap: wrap;
        }
        .nav-item {
            background: url('images/scroll-bg.png');
            background: linear-gradient(45deg, #3c2f2f, #4a0e0e);
            background-size: cover;
            padding: 8px 15px;
            color: #d4af37;
            cursor: pointer;
            transition: transform 0.3s;
            font-size: 14px;
            border-radius: 5px;
        }
        .nav-item:hover {
            transform: scale(1.1);
        }
        .main-container {
            max-width: 1100px;
            margin: 10px auto;
            padding: 10px;
            position: relative;
            display: flex;
            justify-content: center;
        }
        .sidebar {
            width: 180px;
            background: #3c2f2f url('images/indian-pattern.png');
            background: #3c2f2f;
            padding: 15px;
            border: 2px solid #d4af37;
            border-radius: 10px;
            height: fit-content;
            position: absolute;
            left: -200px;
            top: 0;
            transition: left 1s ease-in-out, box-shadow 1s ease-in-out;
            box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.5);
            z-index: 10;
            overflow-y: auto;
            max-height: 80vh;
        }
        .sidebar.open {
            left: 0;
            display: block;
            box-shadow: 5px 5px 15px rgba(212, 175, 55, 0.5), 0 0 20px rgba(255, 140, 0, 0.7);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 5px 5px 15px rgba(212, 175, 55, 0.5), 0 0 20px rgba(255, 140, 0, 0.7); }
            50% { box-shadow: 5px 5px 15px rgba(212, 175, 55, 0.8), 0 0 30px rgba(255, 140, 0, 1); }
            100% { box-shadow: 5px 5px 15px rgba(212, 175, 55, 0.5), 0 0 20px rgba(255, 140, 0, 0.7); }
        }
        .tab {
            background: url('images/paper-texture.jpg');
            background: #4a0e0e;
            padding: 10px;
            margin-bottom: 10px;
            color: #e0d0b0;
            cursor: pointer;
            border: 1px solid #d4af37;
            border-radius: 5px;
            transition: background 0.3s, transform 0.3s;
            text-align: center;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            font-size: 14px;
        }
        .tab:hover, .tab.active {
            background: #ff8c00;
            color: #2b0a0a;
            transform: scale(1.05);
        }
        .content {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 600px;
            min-height: 400px;
            padding: 10px;
        }
        .section {
            display: none;
            background: #3c2f2f url('images/indian-pattern.png');
            background: #3c2f2f;
            padding: 15px;
            border: 2px solid #d4af37;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
            width: 100%;
            max-width: 600px;
        }
        .section.active {
            display: block;
        }
        .catalog-tab {
            display: none;
            width: 100%;
        }
        .catalog-tab.active {
            display: block;
        }
        .filter {
            margin-bottom: 15px;
            text-align: center;
            width: 100%;
        }
        .mandala-select {
            position: relative;
            display: inline-block;
            margin: 0 5px;
        }
        .mandala-button {
            background: linear-gradient(45deg, #d4af37, #ff8c00);
            color: #2b0a0a;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s;
            font-size: 14px;
        }
        .mandala-button:hover {
            transform: scale(1.05);
        }
        .mandala-options {
            display: none;
            position: absolute;
            background: #4a0e0e url('images/indian-pattern.png');
            background: #4a0e0e;
            border: 2px solid #d4af37;
            border-radius: 5px;
            padding: 10px;
            z-index: 10;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.5);
        }
        .mandala-options div {
            padding: 5px;
            color: #e0d0b0;
            cursor: pointer;
            transition: background 0.3s;
            font-size: 14px;
        }
        .mandala-options div:hover {
            background: #ff8c00;
        }
        .placeholder {
            color: #e0d0b0;
            font-size: 16px;
            text-align: center;
            margin-top: 20px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            position: relative;
            animation: mandalaFade 3s infinite;
        }
        @keyframes mandalaFade {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }
        .placeholder::before {
            content: '';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 30px;
            background: url('images/mandala-icon.png') no-repeat center;
            background: none;
            background-size: contain;
            opacity: 0.5;
        }
        .no-products {
            color: #e0d0b0;
            font-size: 16px;
            text-align: center;
            margin-top: 20px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            display: none;
        }
        .product-card, .job-card, .message-card {
            background: url('images/paper-texture.jpg');
            background: #4a0e0e;
            border: 2px solid #d4af37;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(212, 175, 55, 0.3);
            opacity: 0;
            transform: translateX(-20px) rotate(-5deg);
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            cursor: pointer;
        }
        .product-card.visible, .job-card.visible, .message-card.visible {
            opacity: 1;
            transform: translateX(0) rotate(0deg);
        }
        .product-card:hover, .job-card:hover, .message-card:hover {
            transform: translateY(-5px);
        }
        .product-card h3, .job-card h3, .message-card h3 {
            color: #ff8c00;
            margin: 0 0 8px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            font-size: 16px;
        }
        .product-card p, .job-card p, .message-card p {
            color: #e0d0b0;
            margin: 5px 0;
            font-size: 14px;
        }
        .deal-button {
            background: linear-gradient(45deg, #d4af37, #ff8c00);
            color: #2b0a0a;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            animation: wave 2s infinite;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            font-size: 14px;
            width: 100%;
        }
        .deal-button:hover {
            background: #ff8c00;
            animation: none;
            transform: scale(1.05);
        }
        @keyframes wave {
            0% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
            100% { transform: translateY(0); }
        }
        .profile-ledger {
            background: url('images/paper-texture.jpg');
            background: #4a0e0e;
            padding: 15px;
            border: 2px solid #d4af37;
            border-radius: 10px;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 100;
        }
        .modal-content {
            background: #4a0e0e url('images/indian-pattern.png');
            background: #4a0e0e;
            width: 90%;
            max-width: 400px;
            margin: 15% auto;
            padding: 15px;
            border: 2px solid #d4af37;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }
        .modal-content h3 {
            color: #ff8c00;
            font-size: 16px;
        }
        .modal-content p {
            color: #e0d0b0;
            font-size: 14px;
        }
        .close {
            color: #d4af37;
            float: right;
            font-size: 24px;
            cursor: pointer;
        }
        .loader {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            border: 4px solid #d4af37;
            border-top: 4px solid #ff8c00;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            z-index: 101;
        }
        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        .auth-modal-content {
            background: #4a0e0e url('images/indian-pattern.png');
            background: #4a0e0e;
            width: 90%;
            max-width: 400px;
            margin: 15% auto;
            padding: 20px;
            border: 2px solid #d4af37;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }
        .auth-modal-content h3 {
            color: #ff8c00;
            margin-bottom: 15px;
        }
        .auth-modal-content input {
            display: block;
            width: 80%;
            margin: 10px auto;
            padding: 10px;
            background: #e0d0b0;
            border: 1px solid #d4af37;
            border-radius: 5px;
            color: #2b0a0a;
            font-family: 'Georgia', serif;
        }
        .auth-modal-content button {
            background: linear-gradient(45deg, #d4af37, #ff8c00);
            color: #2b0a0a;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.3s;
            margin: 5px;
        }
        .auth-modal-content button:hover {
            transform: scale(1.05);
        }
        .auth-modal-content .switch-form {
            color: #d4af37;
            cursor: pointer;
            text-decoration: underline;
            margin-top: 10px;
        }
        .auth-modal-content .switch-form:hover {
            color: #ff8c00;
        }
        .login-button, .register-button {
            background: linear-gradient(45deg, #d4af37, #ff8c00);
            color: #2b0a0a;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.3s;
            font-size: 16px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            margin: 5px;
        }
        .login-button:hover, .register-button:hover {
            transform: scale(1.05);
        }
        .reviews {
            margin-top: 10px;
            border-top: 1px solid #d4af37;
            padding-top: 10px;
            display: none;
        }
        .review {
            background: rgba(0, 0, 0, 0.3);
            padding: 5px;
            margin: 5px 0;
            border-radius: 5px;
            font-size: 12px;
            color: #e0d0b0;
        }
        .review p {
            margin: 0;
        }
        .rating {
            color: #ff8c00;
            margin-bottom: 5px;
        }
        .moderator-response {
            margin-top: 5px;
            font-style: italic;
            color: #ff8c00;
            font-size: 11px;
        }
        .weights {
            margin-top: 10px;
            border-top: 1px solid #d4af37;
            padding-top: 10px;
            display: none;
        }
        .weight-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 5px 0;
        }
        .weight-option p {
            margin: 0;
        }
        .discount {
            color: #ff4040;
            font-weight: bold;
            margin: 5px 0;
        }
        .referral-section {
            margin-top: 15px;
            border-top: 1px solid #d4af37;
            padding-top: 10px;
        }
        .referral-section p {
            color: #e0d0b0;
            font-size: 14px;
        }
        .referral-link {
            background: #4a0e0e;
            padding: 5px;
            border-radius: 5px;
            word-break: break-all;
        }
        @media (max-width: 600px) {
            .logo {
                font-size: 24px;
            }
            .header-text {
                font-size: 12px;
            }
            .nav-item {
                font-size: 12px;
                padding: 6px 10px;
            }
            .sidebar {
                width: 150px;
                left: -170px;
            }
            .sidebar.open {
                left: 0;
            }
            .tab {
                font-size: 12px;
                padding: 8px;
            }
            .content {
                padding: 5px;
            }
            .mandala-button {
                font-size: 12px;
                padding: 6px 12px;
            }
            .mandala-options div {
                font-size: 12px;
            }
            .product-card h3, .job-card h3, .message-card h3 {
                font-size: 14px;
            }
            .product-card p, .job-card p, .message-card p {
                font-size: 12px;
            }
            .deal-button {
                font-size: 12px;
                padding: 6px 12px;
            }
            .login-button, .register-button {
                font-size: 14px;
                padding: 8px 15px;
            }
            .language-button {
                font-size: 10px;
                padding: 4px 8px;
            }
            .language-switcher {
                top: 45px; /* Корректируем для мобильных */
            }
        }
        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(45deg, #1a0a0a, #0a1b0a);
            }
            .header {
                background: #3a0e0e url('images/fabric-texture.jpg');
                background: linear-gradient(45deg, #3a0e0e, #4a0e0e);
            }
            .nav {
                background: rgba(0, 0, 0, 0.9);
            }
        }
    </style>
</head>
<body>
    <div class="loader" id="loader"></div>
    <div class="header">
        <div class="logo" data-i18n="title">Goa Shadow Bazaar</div>
        <div class="header-text" data-i18n="subtitle">Тёмные сделки Гоа</div>
        <div class="language-switcher">
            <button class="language-button" onclick="setLanguage('ru')">RU</button>
            <button class="language-button" onclick="setLanguage('en')">EN</button>
            <button class="language-button" onclick="setLanguage('hi')">HI</button>
        </div>
    </div>
    <div class="nav">
        <div class="nav-item" onclick="toggleSection('catalog')" data-i18n="nav-catalog">Каталог</div>
        <div class="nav-item" onclick="toggleSection('jobs')" data-i18n="nav-jobs">Вакансии</div>
        <div class="nav-item" onclick="toggleSection('profile')" data-i18n="nav-profile">Книга учёта</div>
        <div class="nav-item" onclick="toggleSection('messages')" data-i18n="nav-messages">Сообщения</div>
    </div>
    <div class="main-container">
        <div class="section catalog" id="catalog">
            <div class="sidebar" id="sidebar">
                <div class="tab" onclick="toggleTab('marijuana')" data-i18n="tab-marijuana">Марихуана</div>
                <div class="tab" onclick="toggleTab('hashish')" data-i18n="tab-hashish">Гашиш</div>
                <div class="tab" onclick="toggleTab('cocaine')" data-i18n="tab-cocaine">Кокаин</div>
                <div class="tab" onclick="toggleTab('meth')" data-i18n="tab-meth">Метамфетамин</div>
                <div class="tab" onclick="toggleTab('amphetamine')" data-i18n="tab-amphetamine">Амфетамин</div>
                <div class="tab" onclick="toggleTab('mephedrone')" data-i18n="tab-mephedrone">Мефедрон</div>
                <div class="tab" onclick="toggleTab('mdma')" data-i18n="tab-mdma">МДМА</div>
                <div class="tab" onclick="toggleTab('lsd')" data-i18n="tab-lsd">ЛСД</div>
                <div class="tab" onclick="toggleTab('heroin')" data-i18n="tab-heroin">Героин</div>
            </div>
            <div class="content">
                <div class="filter">
                    <div class="mandala-select">
                        <button class="mandala-button" id="district-button" data-i18n="district-all">Район: Все</button>
                        <div class="mandala-options" id="district-options">
                            <div onclick="selectDistrict('all')" data-i18n="district-all-option">Все районы</div>
                            <div onclick="selectDistrict('anjuna')" data-i18n="district-anjuna">Анджуна</div>
                            <div onclick="selectDistrict('baga')" data-i18n="district-baga">Бага</div>
                            <div onclick="selectDistrict('calangute')" data-i18n="district-calangute">Калангут</div>
                            <div onclick="selectDistrict('morjim')" data-i18n="district-morjim">Морджим</div>
                            <div onclick="selectDistrict('panaji')" data-i18n="district-panaji">Панаджи</div>
                            <div onclick="selectDistrict('arambol')" data-i18n="district-arambol">Арамболь</div>
                        </div>
                    </div>
                    <div class="mandala-select">
                        <button class="mandala-button" id="stock-button" data-i18n="stock-all">Наличие: Все</button>
                        <div class="mandala-options" id="stock-options">
                            <div onclick="selectStock('all')" data-i18n="stock-all-option">Все</div>
                            <div onclick="selectStock('in-stock')" data-i18n="in-stock">В наличии</div>
                            <div onclick="selectStock('out-of-stock')" data-i18n="out-of-stock">Нет в наличии</div>
                        </div>
                    </div>
                    <div class="mandala-select">
                        <button class="mandala-button" id="discount-button" data-i18n="discount-all">Скидки: Все</button>
                        <div class="mandala-options" id="discount-options">
                            <div onclick="selectDiscount('all')" data-i18n="discount-all-option">Все</div>
                            <div onclick="selectDiscount('with-discount')" data-i18n="with-discount">Со скидкой</div>
                            <div onclick="selectDiscount('no-discount')" data-i18n="no-discount">Без скидки</div>
                        </div>
                    </div>
                </div>
                <div class="placeholder" id="placeholder" data-i18n="placeholder">Выберите категорию в меню слева</div>
                <div class="no-products" id="no-products" data-i18n="no-products">Товаров в этом районе нет</div>
                <div class="catalog-tab" id="marijuana"></div>
                <div class="catalog-tab" id="hashish"></div>
                <div class="catalog-tab" id="cocaine"></div>
                <div class="catalog-tab" id="meth"></div>
                <div class="catalog-tab" id="amphetamine"></div>
                <div class="catalog-tab" id="mephedrone"></div>
                <div class="catalog-tab" id="mdma"></div>
                <div class="catalog-tab" id="lsd"></div>
                <div class="catalog-tab" id="heroin"></div>
            </div>
        </div>
        <div class="section jobs" id="jobs">
            <div class="job-card">
                <h3 data-i18n="job1-title">Курьер по пляжам Гоа</h3>
                <p data-i18n="job1-desc">Обязанности: Развозить товары по пляжам Анджуны и Баги.</p>
                <p data-i18n="job1-salary">Оплата: ₹50000/месяц</p>
                <button class="deal-button" onclick="checkAuthBeforeApply('Курьер по пляжам Гоа')" data-i18n="apply">Подать заявку</button>
            </div>
            <div class="job-card">
                <h3 data-i18n="job2-title">Химик для рейвов</h3>
                <p data-i18n="job2-desc">Обязанности: Производить товары для вечеринок в Арамболе.</p>
                <p data-i18n="job2-salary">Оплата: ₹100000/месяц</p>
                <button class="deal-button" onclick="checkAuthBeforeApply('Химик для рейвов')" data-i18n="apply">Подать заявку</button>
            </div>
            <div class="job-card">
                <h3 data-i18n="job3-title">Смотритель клада</h3>
                <p data-i18n="job3-desc">Обязанности: Прятать товары в Калангуте и следить за ними.</p>
                <p data-i18n="job3-salary">Оплата: ₹40000/месяц</p>
                <button class="deal-button" onclick="checkAuthBeforeApply('Смотритель клада')" data-i18n="apply">Подать заявку</button>
            </div>
        </div>
        <div class="section profile" id="profile">
            <div id="profile-content">
                <!-- Содержимое будет добавлено через JS -->
            </div>
        </div>
        <div class="section messages" id="messages">
            <div class="message-card">
                <h3 data-i18n="message1-title">Товар готов</h3>
                <p data-i18n="message1-text">Ваш заказ "Goa Trance" спрятан у Tito’s Lane, Бага.</p>
            </div>
            <div class="message-card">
                <h3 data-i18n="message2-title">Пополните баланс</h3>
                <p data-i18n="message2-text">Отправьте ₹, чтобы забрать "Anjuna Haze" в Анджуне.</p>
            </div>
        </div>
    </div>
    <div class="modal" id="depositModal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('depositModal')">×</span>
            <h3 data-i18n="deposit-title">Пополните баланс</h3>
            <p data-i18n="deposit-text1">Переведите ₹ через UPI или криптовалюту (USDT, BTC) на этот адрес:</p>
            <p><strong>0xFakeWallet123456789</strong></p>
            <p data-i18n="deposit-text2">После оплаты доступ к товарам откроется. Ожидайте!</p>
            <button class="deal-button" onclick="depositFunds()" data-i18n="deposit-button">Оплатил</button>
        </div>
    </div>
    <div class="modal" id="authModal">
        <div class="auth-modal-content">
            <span class="close" onclick="closeModal('authModal')">×</span>
            <div id="loginForm">
                <h3 data-i18n="login-title">Вход</h3>
                <input type="text" id="loginUsername" data-i18n="[placeholder]login-username">
                <input type="password" id="loginPassword" data-i18n="[placeholder]login-password">
                <button onclick="login()" data-i18n="login-button">Войти</button>
                <p class="switch-form" onclick="showRegisterForm()" data-i18n="switch-to-register">Нет аккаунта? Зарегистрируйтесь!</p>
            </div>
            <div id="registerForm" style="display: none;">
                <h3 data-i18n="register-title">Регистрация</h3>
                <input type="text" id="regUsername" data-i18n="[placeholder]register-username">
                <input type="password" id="regPassword" data-i18n="[placeholder]register-password">
                <input type="password" id="regConfirmPassword" data-i18n="[placeholder]register-confirm-password">
                <input type="text" id="regReferralCode" data-i18n="[placeholder]register-referral">
                <button onclick="register()" data-i18n="register-button">Зарегистрироваться</button>
                <p class="switch-form" onclick="showLoginForm()" data-i18n="switch-to-login">Уже есть аккаунт? Войдите!</p>
            </div>
        </div>
    </div>
    <script>
        let currentSection = null;
        let currentTab = null;
        let selectedDistrict = 'all';
        let isSidebarOpen = false;
        let touchStartX = 0;
        let touchEndX = 0;
        let currentUser = null;
        let currentLanguage = 'ru';
        let selectedStock = 'all';
        let selectedDiscount = 'all';

        const translations = {
            ru: {
                title: "Goa Shadow Bazaar",
                subtitle: "Тёмные сделки Гоа",
                "nav-catalog": "Каталог",
                "nav-jobs": "Вакансии",
                "nav-profile": "Книга учёта",
                "nav-messages": "Сообщения",
                "tab-marijuana": "Марихуана",
                "tab-hashish": "Гашиш",
                "tab-cocaine": "Кокаин",
                "tab-meth": "Метамфетамин",
                "tab-amphetamine": "Амфетамин",
                "tab-mephedrone": "Мефедрон",
                "tab-mdma": "МДМА",
                "tab-lsd": "ЛСД",
                "tab-heroin": "Героин",
                "district-all": "Район: Все",
                "district-all-option": "Все районы",
                "district-anjuna": "Анджуна",
                "district-baga": "Бага",
                "district-calangute": "Калангут",
                "district-morjim": "Морджим",
                "district-panaji": "Панаджи",
                "district-arambol": "Арамболь",
                placeholder: "Выберите категорию в меню слева",
                "no-products": "Товаров в этом районе нет",
                "job1-title": "Курьер по пляжам Гоа",
                "job1-desc": "Обязанности: Развозить товары по пляжам Анджуны и Баги.",
                "job1-salary": "Оплата: ₹50000/месяц",
                "job2-title": "Химик для рейвов",
                "job2-desc": "Обязанности: Производить товары для вечеринок в Арамболе.",
                "job2-salary": "Оплата: ₹100000/месяц",
                "job3-title": "Смотритель клада",
                "job3-desc": "Обязанности: Прятать товары в Калангуте и следить за ними.",
                "job3-salary": "Оплата: ₹40000/месяц",
                apply: "Подать заявку",
                "message1-title": "Товар готов",
                "message1-text": 'Ваш заказ "Goa Trance" спрятан у Tito’s Lane, Бага.',
                "message2-title": "Пополните баланс",
                "message2-text": 'Отправьте ₹, чтобы забрать "Anjuna Haze" в Анджуне.',
                "deposit-title": "Пополните баланс",
                "deposit-text1": "Переведите ₹ через UPI или криптовалюту (USDT, BTC) на этот адрес:",
                "deposit-text2": "После оплаты доступ к товарам откроется. Ожидайте!",
                "deposit-button": "Оплатил",
                "login-title": "Вход",
                "login-username": "Имя пользователя",
                "login-password": "Пароль",
                "login-button": "Войти",
                "switch-to-register": "Нет аккаунта? Зарегистрируйтесь!",
                "register-title": "Регистрация",
                "register-username": "Имя пользователя",
                "register-password": "Пароль",
                "register-confirm-password": "Подтвердите пароль",
                "register-referral": "Реферальный код (если есть)",
                "register-button": "Зарегистрироваться",
                "switch-to-login": "Уже есть аккаунт? Войдите!",
                "profile-title": "Ваш учёт",
                "profile-name": "Имя",
                "profile-balance": "Баланс",
                "profile-orders": "Заказы",
                "profile-referral-bonus": "Реферальные бонусы",
                "profile-deposit": "Пополнить",
                "profile-logout": "Выйти 🚪",
                "referral-link-text": "Ваша реферальная ссылка:",
                "referral-invite": "Приглашайте друзей и получайте ₹1000 за каждого!",
                "login-prompt": "Войти 🔑",
                "register-prompt": "Регистрация 📝",
                "in-stock": "В наличии",
                "out-of-stock": "Нет в наличии",
                "take-deal": "Оформить сделку",
                "pre-order": "Предзаказ",
                discount: "Скидка",
                usdt: "USDT",
                "stock-all": "Наличие: Все",
                "stock-all-option": "Все",
                "with-discount": "Со скидкой",
                "no-discount": "Без скидки",
                "discount-all": "Скидки: Все",
                "discount-all-option": "Все"
            },
            en: {
                title: "Goa Shadow Bazaar",
                subtitle: "Dark Deals of Goa",
                "nav-catalog": "Catalog",
                "nav-jobs": "Jobs",
                "nav-profile": "Ledger",
                "nav-messages": "Messages",
                "tab-marijuana": "Marijuana",
                "tab-hashish": "Hashish",
                "tab-cocaine": "Cocaine",
                "tab-meth": "Methamphetamine",
                "tab-amphetamine": "Amphetamine",
                "tab-mephedrone": "Mephedrone",
                "tab-mdma": "MDMA",
                "tab-lsd": "LSD",
                "tab-heroin": "Heroin",
                "district-all": "District: All",
                "district-all-option": "All Districts",
                "district-anjuna": "Anjuna",
                "district-baga": "Baga",
                "district-calangute": "Calangute",
                "district-morjim": "Morjim",
                "district-panaji": "Panaji",
                "district-arambol": "Arambol",
                placeholder: "Select a category from the menu on the left",
                "no-products": "No products in this district",
                "job1-title": "Beach Courier in Goa",
                "job1-desc": "Responsibilities: Deliver goods across Anjuna and Baga beaches.",
                "job1-salary": "Salary: ₹50000/month",
                "job2-title": "Rave Chemist",
                "job2-desc": "Responsibilities: Produce goods for parties in Arambol.",
                "job2-salary": "Salary: ₹100000/month",
                "job3-title": "Stash Keeper",
                "job3-desc": "Responsibilities: Hide goods in Calangute and monitor them.",
                "job3-salary": "Salary: ₹40000/month",
                apply: "Apply",
                "message1-title": "Item Ready",
                "message1-text": 'Your order "Goa Trance" is hidden at Tito’s Lane, Baga.',
                "message2-title": "Top Up Balance",
                "message2-text": 'Send ₹ to pick up "Anjuna Haze" in Anjuna.',
                "deposit-title": "Top Up Your Balance",
                "deposit-text1": "Transfer ₹ via UPI or crypto (USDT, BTC) to this address:",
                "deposit-text2": "After payment, access to items will be granted. Please wait!",
                "deposit-button": "Paid",
                "login-title": "Login",
                "login-username": "Username",
                "login-password": "Password",
                "login-button": "Login",
                "switch-to-register": "No account? Register now!",
                "register-title": "Register",
                "register-username": "Username",
                "register-password": "Password",
                "register-confirm-password": "Confirm Password",
                "register-referral": "Referral Code (if any)",
                "register-button": "Register",
                "switch-to-login": "Already have an account? Login!",
                "profile-title": "Your Ledger",
                "profile-name": "Name",
                "profile-balance": "Balance",
                "profile-orders": "Orders",
                "profile-referral-bonus": "Referral Bonuses",
                "profile-deposit": "Deposit",
                "profile-logout": "Logout 🚪",
                "referral-link-text": "Your Referral Link:",
                "referral-invite": "Invite friends and earn ₹1000 for each!",
                "login-prompt": "Login 🔑",
                "register-prompt": "Register 📝",
                "in-stock": "In Stock",
                "out-of-stock": "Out of Stock",
                "take-deal": "Make a Deal",
                "pre-order": "Pre-order",
                discount: "Discount",
                usdt: "USDT",
                "stock-all": "Stock: All",
                "stock-all-option": "All",
                "with-discount": "With Discount",
                "no-discount": "No Discount",
                "discount-all": "Discounts: All",
                "discount-all-option": "All"
            },
            hi: {
                title: "गोवा शैडो बाजार",
                subtitle: "गोवा की डार्क डील्स",
                "nav-catalog": "सूची",
                "nav-jobs": "नौकरियां",
                "nav-profile": "खाता बही",
                "nav-messages": "संदेश",
                "tab-marijuana": "मारिजुआना",
                "tab-hashish": "हशीश",
                "tab-cocaine": "कोकेन",
                "tab-meth": "मेथमफेटामाइन",
                "tab-amphetamine": "एम्फेटामाइन",
                "tab-mephedrone": "मेफेड्रोन",
                "tab-mdma": "एमडीएमए",
                "tab-lsd": "एलएसडी",
                "tab-heroin": "हेरोइन",
                "district-all": "जिला: सभी",
                "district-all-option": "सभी जिले",
                "district-anjuna": "अंजुना",
                "district-baga": "बागा",
                "district-calangute": "कालंगुट",
                "district-morjim": "मोरजिम",
                "district-panaji": "पणजी",
                "district-arambol": "अरंबोल",
                placeholder: "बाईं ओर मेनू से एक श्रेणी चुनें",
                "no-products": "इस जिले में कोई उत्पाद नहीं हैं",
                "job1-title": "गोवा के समुद्र तटों पर कूरियर",
                "job1-desc": "जिम्मेदारियां: अंजुना और बागा समुद्र तटों पर सामान पहुंचाना।",
                "job1-salary": "वेतन: ₹50000/माह",
                "job2-title": "रेव पार्टियों के लिए रसायनज्ञ",
                "job2-desc": "जिम्मेदारियां: अरंबोल में पार्टियों के लिए सामान तैयार करना।",
                "job2-salary": "वेतन: ₹100000/माह",
                "job3-title": "खजाने का रखवाला",
                "job3-desc": "जिम्मेदारियां: कालंगुट में सामान छिपाना और उनकी निगरानी करना।",
                "job3-salary": "वेतन: ₹40000/माह",
                apply: "आवेदन करें",
                "message1-title": "सामान तैयार है",
                "message1-text": 'आपका ऑर्डर "Goa Trance" टिटो लेन, बागा में छिपा है।',
                "message2-title": "बैलेंस टॉप अप करें",
                "message2-text": 'अंजुना में "Anjuna Haze" लेने के लिए ₹ भेजें।',
                "deposit-title": "अपना बैलेंस टॉप अप करें",
                "deposit-text1": "इस पते पर UPI या क्रिप्टो (USDT, BTC) के माध्यम से ₹ ट्रांसफर करें:",
                "deposit-text2": "भुगतान के बाद, सामान तक पहुंच मिल जाएगी। कृपया प्रतीक्षा करें!",
                "deposit-button": "भुगतान किया",
                "login-title": "लॉगिन करें",
                "login-username": "उपयोगकर्ता नाम",
                "login-password": "पासवर्ड",
                "login-button": "लॉगिन",
                "switch-to-register": "कोई खाता नहीं? रजिस्टर करें!",
                "register-title": "रजिस्टर करें",
                "register-username": "उपयोगकर्ता नाम",
                "register-password": "पासवर्ड",
                "register-confirm-password": "पासवर्ड की पुष्टि करें",
                "register-referral": "रेफरल कोड (यदि कोई हो)",
                "register-button": "रजिस्टर",
                "switch-to-login": "पहले से खाता है? लॉगिन करें!",
                "profile-title": "आपकी खाता बही",
                "profile-name": "नाम",
                "profile-balance": "बैलेंस",
                "profile-orders": "ऑर्डर",
                "profile-referral-bonus": "रेफरल बोनस",
                "profile-deposit": "जमा करें",
                "profile-logout": "लॉगआउट 🚪",
                "referral-link-text": "आपका रेफरल लिंक:",
                "referral-invite": "दोस्तों को आमंत्रित करें और प्रत्येक के लिए ₹1000 कमाएं!",
                "login-prompt": "लॉगिन 🔑",
                "register-prompt": "रजिस्टर 📝",
                "in-stock": "स्टॉक में",
                "out-of-stock": "स्टॉक में नहीं",
                "take-deal": "सौदा करें",
                "pre-order": "प्री-ऑर्डर",
                discount: "छूट",
                usdt: "USDT",
                "stock-all": "स्टॉक: सभी",
                "stock-all-option": "सभी",
                "with-discount": "छूट के साथ",
                "no-discount": "छूट के बिना",
                "discount-all": "छूट: सभी",
                "discount-all-option": "सभी"
            }
        };

        function setLanguage(lang) {
            currentLanguage = lang;
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                const attr = key.startsWith('[placeholder]') ? 'placeholder' : null;
                const translationKey = attr ? key.replace('[placeholder]', '') : key;
                if (attr) {
                    element.setAttribute(attr, translations[lang][translationKey]);
                } else {
                    element.innerText = translations[lang][translationKey];
                }
            });
            const districtButton = document.getElementById('district-button');
            const districtText = selectedDistrict === 'all' ? translations[lang]['district-all-option'] : translations[lang][`district-${selectedDistrict}`];
            districtButton.innerText = `${translations[lang]['district-all'].split(':')[0]}: ${districtText}`;
            const stockButton = document.getElementById('stock-button');
            const stockText = selectedStock === 'all' ? translations[lang]['stock-all-option'] : translations[lang][selectedStock];
            stockButton.innerText = `${translations[lang]['stock-all'].split(':')[0]}: ${stockText}`;
            const discountButton = document.getElementById('discount-button');
            const discountText = selectedDiscount === 'all' ? translations[lang]['discount-all-option'] : translations[lang][selectedDiscount];
            discountButton.innerText = `${translations[lang]['discount-all'].split(':')[0]}: ${discountText}`;
            initProducts();
            updateProfile();
        }

        function generateWeights(category) {
            const weights = [];
            if (category === 'marijuana' || category === 'hashish') {
                weights.push(10);
                const additionalWeights = [];
                for (let i = 0; i < 4; i++) {
                    const weight = Math.floor(Math.random() * (100 - 10 + 1)) + 10;
                    if (!additionalWeights.includes(weight) && weight !== 10) {
                        additionalWeights.push(weight);
                    }
                }
                weights.push(...additionalWeights.sort((a, b) => a - b));
            } else if (category === 'cocaine') {
                weights.push(0.5, 1);
                const additionalWeights = [];
                for (let i = 0; i < 3; i++) {
                    const weight = Math.random() * (20 - 1) + 1;
                    const roundedWeight = Math.round(weight * 2) / 2;
                    if (!additionalWeights.includes(roundedWeight) && roundedWeight !== 0.5 && roundedWeight !== 1) {
                        additionalWeights.push(roundedWeight);
                    }
                }
                weights.push(...additionalWeights.sort((a, b) => a - b));
            } else {
                for (let i = 0; i < 5; i++) {
                    const weight = Math.floor(Math.random() * (20 - 1 + 1)) + 1;
                    if (!weights.includes(weight)) {
                        weights.push(weight);
                    }
                }
                weights.sort((a, b) => a - b);
            }
            return weights;
        }

        function generateReviews() {
            const positiveReviews = {
                ru: ["Отличный товар, всё понравилось!", "Качество на высоте, рекомендую!", "Эффект потрясающий, всё прошло гладко!", "Товар высокого качества, доволен!", "Доставка быстрая, всё на месте!"],
                en: ["Great product, loved it!", "Top-notch quality, recommend!", "Amazing effect, everything went smoothly!", "High-quality product, satisfied!", "Fast delivery, everything’s in place!"],
                hi: ["शानदार सामान, बहुत पसंद आया!", "क्वालिटी शानदार है, सुझाव देता हूँ!", "प्रभाव अद्भुत है, सब कुछ सुचारू रहा!", "उच्च गुणवत्ता वाला सामान, संतुष्ट हूँ!", "तेज डिलीवरी, सब कुछ जगह पर है!"]
            };
            const negativeReviews = {
                ru: ["Товар не оправдал ожиданий.", "Качество среднее, ожидал большего.", "Доставка задержалась, это неудобно.", "Эффект слабый, не впечатлило.", "Товар не нашли на месте, разочарован."],
                en: ["Product didn’t meet expectations.", "Average quality, expected more.", "Delivery was delayed, inconvenient.", "Weak effect, not impressed.", "Couldn’t find the product, disappointed."],
                hi: ["सामान उम्मीदों पर खरा नहीं उतरा।", "क्वालिटी औसत है, और उम्मीद थी।", "डिलीवरी में देरी हुई, असुविधाजनक।", "प्रभाव कमजोर, प्रभावित नहीं हुआ।", "सामान जगह पर नहीं मिला, निराश हूँ।"]
            };
            const positiveModeratorResponses = {
                ru: ["Спасибо за ваш отзыв! Рады, что вам понравилось.", "Благодарим за высокую оценку!", "Спасибо, что выбрали нас! Обращайтесь снова."],
                en: ["Thank you for your review! Glad you liked it.", "We appreciate your high rating!", "Thanks for choosing us! Come back again."],
                hi: ["आपके रिव्यू के लिए धन्यवाद! खुशी है कि आपको पसंद आया।", "आपकी उच्च रेटिंग के लिए धन्यवाद!", "हमें चुनने के लिए धन्यवाद! फिर से आएं।"]
            };
            const negativeModeratorResponses = {
                ru: ["Приносим извинения за неудобства, мы разберёмся!", "Сожалеем, что не оправдали ожиданий. Свяжитесь с нами для решения вопроса.", "Извините за задержку, мы работаем над улучшением сервиса."],
                en: ["We apologize for the inconvenience, we’ll look into it!", "Sorry we didn’t meet your expectations. Contact us to resolve the issue.", "Apologies for the delay, we’re working on improving our service."],
                hi: ["असुविधा के लिए खेद है, हम इसकी जांच करेंगे!", "हमें खेद है कि हम आपकी उम्मीदों पर खरे नहीं उतरे। समस्या हल करने के लिए हमसे संपर्क करें।", "देरी के लिए खेद है, हम अपनी सेवा में सुधार कर रहे हैं।"]
            };
            const reviews = [];
            for (let i = 0; i < 5; i++) {
                const isPositive = Math.random() > 0.4;
                const rating = isPositive ? Math.floor(Math.random() * 2) + 4 : Math.floor(Math.random() * 3) + 1;
                const reviewText = isPositive
                    ? positiveReviews[currentLanguage][Math.floor(Math.random() * positiveReviews[currentLanguage].length)]
                    : negativeReviews[currentLanguage][Math.floor(Math.random() * negativeReviews[currentLanguage].length)];
                const moderatorResponse = isPositive
                    ? positiveModeratorResponses[currentLanguage][Math.floor(Math.random() * positiveModeratorResponses[currentLanguage].length)]
                    : negativeModeratorResponses[currentLanguage][Math.floor(Math.random() * negativeModeratorResponses[currentLanguage].length)];
                reviews.push({ user: "Аноним", text: reviewText, rating, moderatorResponse });
            }
            return reviews;
        }

        const products = {
            marijuana: [
                { id: 'anjuna-haze', name: 'Anjuna Haze (VHQ)', description: 'Трава с пляжей Анджуны, трансовая волна. 70% ТГК.', basePrice: 500, district: 'anjuna', inStock: true },
                { id: 'baga-bud', name: 'Baga Bud (HQ)', description: 'Сочная трава с вечеринок Баги. 65% ТГК.', basePrice: 450, district: 'baga', inStock: false },
                { id: 'arambol-green', name: 'Arambol Green (VHQ)', description: 'Хиппи-трава из Арамболя. 68% ТГК.', basePrice: 480, district: 'arambol', inStock: true }
            ],
            hashish: [
                { id: 'arambol-charas', name: 'Arambol Charas (VHQ)', description: 'Гашиш с хиппи-вайбом Арамболя. Мягкий и глубокий.', basePrice: 600, district: 'arambol', inStock: true },
                { id: 'morjim-hash', name: 'Morjim Hash (HQ)', description: 'Гашиш с тихих пляжей Морджима. Глубокий релакс.', basePrice: 550, district: 'morjim', inStock: false }
            ],
            cocaine: [
                { id: 'baga-dust', name: 'Baga Dust (VHQ)', description: 'Кокс с вечеринок Баги. 95% чистоты, чистый взлёт.', basePrice: 12000, district: 'baga', inStock: true },
                { id: 'calangute-snow', name: 'Calangute Snow (HQ)', description: 'Кокс с шумных улиц Калангута. 90% чистоты.', basePrice: 11000, district: 'calangute', inStock: true }
            ],
            meth: [
                { id: 'morjim-rush', name: 'Morjim Rush (VHQ)', description: 'Мет с тихих пляжей Морджима. Быстрый и долгий эффект.', basePrice: 800, district: 'morjim', inStock: false },
                { id: 'panaji-crystal', name: 'Panaji Crystal (HQ)', description: 'Мет с португальских улочек Панаджи. Чистый драйв.', basePrice: 750, district: 'panaji', inStock: true }
            ],
            amphetamine: [
                { id: 'calangute-speed', name: 'Calangute Speed (VHQ)', description: 'Амф с шумных улиц Калангута. Энергия на всю ночь.', basePrice: 650, district: 'calangute', inStock: true },
                { id: 'baga-surge', name: 'Baga Surge (HQ)', description: 'Амф для вечеринок в Баге. Мощный заряд.', basePrice: 600, district: 'baga', inStock: true }
            ],
            mephedrone: [
                { id: 'panaji-spice', name: 'Panaji Spice (VHQ)', description: 'Меф с португальских улочек Панаджи. Эйфория и драйв.', basePrice: 700, district: 'panaji', inStock: true },
                { id: 'anjuna-wave', name: 'Anjuna Wave (HQ)', description: 'Меф с транс-вайбом Анджуны. Эйфория на всю ночь.', basePrice: 650, district: 'anjuna', inStock: false }
            ],
            mdma: [
                { id: 'baga-bliss', name: 'Baga Bliss (VHQ)', description: 'МДМА для вечеринок в Баге. Любовь и экстаз.', basePrice: 400, district: 'baga', inStock: true },
                { id: 'anjuna-love', name: 'Anjuna Love (HQ)', description: 'МДМА с рейвов Анджуны. Чистая эйфория.', basePrice: 380, district: 'anjuna', inStock: true },
                { id: 'calangute-glow', name: 'Calangute Glow (VHQ)', description: 'МДМА для тусовок в Калангуте. Яркие эмоции.', basePrice: 390, district: 'calangute', inStock: false }
            ],
            lsd: [
                { id: 'goa-trance', name: 'Goa Trance (VHQ)', description: 'LSD для гоанских рейвов. Глубокий трип под звёзды.', basePrice: 300, district: 'anjuna', inStock: true },
                { id: 'arambol-vision', name: 'Arambol Vision (HQ)', description: 'LSD с хиппи-вайбом Арамболя. Яркие видения.', basePrice: 280, district: 'arambol', inStock: true }
            ],
            heroin: [
                { id: 'arambol-ice', name: 'Arambol Ice (VHQ)', description: 'Героин с хиппи-вайбом Арамболя. 90% чистоты.', basePrice: 1500, district: 'arambol', inStock: true },
                { id: 'panaji-drift', name: 'Panaji Drift (HQ)', description: 'Героин с португальских улочек Панаджи. 85% чистоты.', basePrice: 1400, district: 'panaji', inStock: false }
            ]
        };

        function initProducts() {
            Object.keys(products).forEach(category => {
                const container = document.getElementById(category);
                container.innerHTML = '';
                products[category].forEach(product => {
                    const weights = generateWeights(category);
                    const card = document.createElement('div');
                    card.className = 'product-card';
                    card.setAttribute('data-district', product.district);
                    card.addEventListener('click', () => toggleProductDetails(card));
                    const weightOptions = weights.map(weight => {
                        const pricePerGram = product.basePrice;
                        const price = Math.round(pricePerGram * weight);
                        let discount = 0;
                        if ((category === 'marijuana' || category === 'hashish') && weight >= 20) {
                            discount = 10;
                        } else if (category === 'cocaine' && weight >= 3) {
                            discount = 15;
                        }
                        const discountedPrice = discount ? Math.round(price * (1 - discount / 100)) : price;
                        return { weight, price, discountedPrice, discount, reviews: generateReviews() };
                    });
                    card.innerHTML = `
                        <h3>${product.name}</h3>
                        <p>${product.description}</p>
                        <p>${product.inStock ? translations[currentLanguage]['in-stock'] : translations[currentLanguage]['out-of-stock']}</p>
                        <div class="weights" id="weights-${product.id}">
                            ${weightOptions.map(option => `
                                <div class="weight-option">
                                    <p>${option.weight}g: ₹${option.discountedPrice}${option.discount ? ` <span style="text-decoration: line-through; color: #e0d0b0;">₹${option.price}</span>` : ''} (~${Math.round(option.discountedPrice / 83)} ${translations[currentLanguage].usdt})</p>
                                    <button class="deal-button" onclick="event.stopPropagation(); checkAuthBeforeDeal('${product.id}', ${option.weight}, ${option.discountedPrice})">${product.inStock ? translations[currentLanguage]['take-deal'] : translations[currentLanguage]['pre-order']}</button>
                                </div>
                                ${option.discount ? `<p class="discount">${translations[currentLanguage].discount}: ${option.discount}%</p>` : ''}
                            `).join('')}
                        </div>
                        <div class="reviews" id="reviews-${product.id}">
                            ${weightOptions[0].reviews.map(review => `
                                <div class="review">
                                    <p class="rating">${'★'.repeat(review.rating)}${'☆'.repeat(5 - review.rating)}</p>
                                    <p><strong>${review.user}:</strong> ${review.text}</p>
                                    <p class="moderator-response"><strong>Модератор:</strong> ${review.moderatorResponse}</p>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    container.appendChild(card);
                });
            });
        }

        function toggleProductDetails(card) {
            const weights = card.querySelector('.weights');
            const reviews = card.querySelector('.reviews');
            const isVisible = weights.style.display === 'block';
            weights.style.display = isVisible ? 'none' : 'block';
            reviews.style.display = isVisible ? 'none' : 'block';
        }

        function checkAuth() {
            const user = localStorage.getItem('currentUser');
            if (user) {
                currentUser = JSON.parse(user);
                if (!currentUser.referralCode) {
                    currentUser.referralCode = btoa(currentUser.username).slice(0, 8);
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                }
            }
            updateProfile();
        }

        function updateProfile() {
            const profileContent = document.getElementById('profile-content');
            if (currentUser) {
                profileContent.innerHTML = `
                    <div class="profile-ledger">
                        <h3 data-i18n="profile-title">${translations[currentLanguage]['profile-title']}</h3>
                        <p><span data-i18n="profile-name">${translations[currentLanguage]['profile-name']}</span>: ${currentUser.username}</p>
                        <p><span data-i18n="profile-balance">${translations[currentLanguage]['profile-balance']}</span>: ₹${currentUser.balance || 0}</p>
                        <p><span data-i18n="profile-orders">${translations[currentLanguage]['profile-orders']}</span>: ${currentUser.orders || 0}</p>
                        <p><span data-i18n="profile-referral-bonus">${translations[currentLanguage]['profile-referral-bonus']}</span>: ₹${currentUser.referralBonus || 0}</p>
                        <button class="deal-button" onclick="openModal('depositModal')" data-i18n="profile-deposit">${translations[currentLanguage]['profile-deposit']}</button>
                        <button class="deal-button" onclick="logout()" data-i18n="profile-logout">${translations[currentLanguage]['profile-logout']}</button>
                        <div class="referral-section">
                            <p data-i18n="referral-link-text">${translations[currentLanguage]['referral-link-text']}</p>
                            <p class="referral-link">goashadowbazaar.com/ref/${currentUser.referralCode}</p>
                            <p data-i18n="referral-invite">${translations[currentLanguage]['referral-invite']}</p>
                        </div>
                    </div>
                `;
            } else {
                profileContent.innerHTML = `
                    <button class="login-button" onclick="openLoginModal()" data-i18n="login-prompt">${translations[currentLanguage]['login-prompt']}</button>
                    <button class="register-button" onclick="openRegisterModal()" data-i18n="register-prompt">${translations[currentLanguage]['register-prompt']}</button>
                `;
            }
        }

        function openLoginModal() {
            showLoginForm();
            openModal('authModal');
        }

        function openRegisterModal() {
            showRegisterForm();
            openModal('authModal');
        }

        function register() {
            const username = document.getElementById('regUsername').value;
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;
            const referralCode = document.getElementById('regReferralCode').value;

            if (!username || !password || !confirmPassword) {
                alert('Пожалуйста, заполните все поля.');
                return;
            }

                        if (password !== confirmPassword) {
                alert('Пароли не совпадают, проверьте ещё раз.');
                return;
            }

            const existingUsers = JSON.parse(localStorage.getItem('users')) || [];
            if (existingUsers.some(user => user.username === username)) {
                alert('Пользователь с таким именем уже существует.');
                return;
            }

            const newUser = {
                username,
                password,
                balance: referralCode ? 1000 : 0, // Бонус за реферальный код
                referralCode: btoa(username).slice(0, 8),
                referralBonus: 0,
                orders: 0
            };

            if (referralCode) {
                const referrer = existingUsers.find(user => user.referralCode === referralCode);
                if (referrer) {
                    referrer.referralBonus = (referrer.referralBonus || 0) + 1000;
                    existingUsers[existingUsers.findIndex(user => user.referralCode === referralCode)] = referrer;
                }
            }

            existingUsers.push(newUser);
            localStorage.setItem('users', JSON.stringify(existingUsers));
            localStorage.setItem('currentUser', JSON.stringify(newUser));
            currentUser = newUser;
            closeModal('authModal');
            updateProfile();
            alert('Регистрация прошла успешно! Добро пожаловать.');
        }

        function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            const users = JSON.parse(localStorage.getItem('users')) || [];
            const user = users.find(u => u.username === username && u.password === password);

            if (!user) {
                alert('Неверное имя пользователя или пароль.');
                return;
            }

            localStorage.setItem('currentUser', JSON.stringify(user));
            currentUser = user;
            closeModal('authModal');
            updateProfile();
            alert('Вход выполнен успешно!');
        }

        function logout() {
            localStorage.removeItem('currentUser');
            currentUser = null;
            updateProfile();
            alert('Вы вышли из аккаунта.');
        }

        function showLoginForm() {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('registerForm').style.display = 'none';
        }

        function showRegisterForm() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
        }

        function toggleSection(section) {
            if (currentSection === section) return;

            if (currentSection) {
                document.getElementById(currentSection).classList.remove('active');
                document.querySelector(`.nav-item[onclick="toggleSection('${currentSection}')"]`).classList.remove('active');
            }
            document.getElementById(section).classList.add('active');
            document.querySelector(`.nav-item[onclick="toggleSection('${section}')"]`).classList.add('active');
            currentSection = section;

            const sidebar = document.getElementById('sidebar');
            if (section === 'catalog') {
                // Если переходим в каталог, открываем сайдбар, если он закрыт
                if (!isSidebarOpen) {
                    toggleSidebar();
                }
            } else {
                // При переходе в другие разделы закрываем сайдбар
                isSidebarOpen = false;
                sidebar.classList.remove('open');
                sidebar.style.display = 'none';
            }

            // Для раздела "Вакансии" добавим отображение карточек
            if (section === 'jobs') {
                const jobCards = document.querySelectorAll('.job-card');
                jobCards.forEach((card, index) => {
                    setTimeout(() => {
                        card.classList.add('visible');
                    }, index * 200);
                });
            }
        }

        function toggleTab(tab) {
            if (currentTab) {
                document.getElementById(currentTab).classList.remove('active');
                document.querySelector(`.tab[onclick="toggleTab('${currentTab}')"]`).classList.remove('active');
            }
            document.getElementById(tab).classList.add('active');
            document.querySelector(`.tab[onclick="toggleTab('${tab}')"]`).classList.add('active');
            currentTab = tab;

            // Закрываем сайдбар при выборе вкладки
            const sidebar = document.getElementById('sidebar');
            isSidebarOpen = false;
            sidebar.classList.remove('open');
            sidebar.style.display = 'none';

            filterProducts();
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            isSidebarOpen = !isSidebarOpen;
            sidebar.classList.toggle('open', isSidebarOpen);
            sidebar.style.display = isSidebarOpen ? 'block' : 'none';
        }

        function toggleMandala(type) {
            const options = document.getElementById(`${type}-options`);
            options.style.display = options.style.display === 'block' ? 'none' : 'block';
        }

        function selectDistrict(district) {
            selectedDistrict = district;
            document.querySelector('#district-options').style.display = 'none';
            const districtButton = document.getElementById('district-button');
            const districtText = district === 'all' ? translations[currentLanguage]['district-all-option'] : translations[currentLanguage][`district-${district}`];
            districtButton.innerText = `${translations[currentLanguage]['district-all'].split(':')[0]}: ${districtText}`;
            filterProducts();
        }

        function filterProducts() {
            if (!currentTab) {
                document.getElementById('placeholder').style.display = 'block';
                document.getElementById('no-products').style.display = 'none';
                return;
            }

            const cards = document.getElementById(currentTab).querySelectorAll('.product-card');
            let visibleCount = 0;

            cards.forEach(card => {
                card.style.display = 'none';
                card.classList.remove('visible');
            });

            cards.forEach((card, index) => {
                const cardDistrict = card.getAttribute('data-district');
                const inStock = card.querySelector('p:nth-child(3)').innerText.includes(translations[currentLanguage]['in-stock']);
                const hasDiscount = card.querySelector('.discount') !== null;

                const districtMatch = selectedDistrict === 'all' || cardDistrict === selectedDistrict;
                const stockMatch = selectedStock === 'all' || (selectedStock === 'in-stock' && inStock) || (selectedStock === 'out-of-stock' && !inStock);
                const discountMatch = selectedDiscount === 'all' || (selectedDiscount === 'with-discount' && hasDiscount) || (selectedDiscount === 'no-discount' && !hasDiscount);

                if (districtMatch && stockMatch && discountMatch) {
                    card.style.display = 'block';
                    setTimeout(() => {
                        card.classList.add('visible');
                    }, index * 200);
                    visibleCount++;
                }
            });

            document.getElementById('no-products').style.display = visibleCount === 0 ? 'block' : 'none';
        }

        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function checkAuthBeforeDeal(productId, weight, price) {
            if (!currentUser) {
                alert('Пожалуйста, войдите, чтобы оформить сделку.');
                openModal('authModal');
                return;
            }
            if (currentUser.balance < price) {
                alert('Недостаточно средств, пополните баланс.');
                openModal('depositModal');
                return;
            }
            currentUser.balance -= price;
            currentUser.orders = (currentUser.orders || 0) + 1;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            updateProfile();
            alert(`Сделка по ${productId} (${weight}г) подтверждена! Проверьте сообщения для деталей.`);
        }

        function checkAuthBeforeApply(jobTitle) {
            if (!currentUser) {
                alert('Пожалуйста, войдите, чтобы подать заявку.');
                openModal('authModal');
                return;
            }
            alert(`Заявка на "${jobTitle}" отправлена! Ожидайте ответа.`);
        }

        function depositFunds() {
            if (!currentUser) {
                alert('Пожалуйста, войдите, чтобы пополнить баланс.');
                openModal('authModal');
                return;
            }
            currentUser.balance = (currentUser.balance || 0) + 5000;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            updateProfile();
            closeModal('depositModal');
            alert('Баланс пополнен на ₹5000! Теперь можете оформлять сделки.');
        }

        const sidebar = document.getElementById('sidebar');
        sidebar.addEventListener('touchstart', (e) => {
            touchStartX = e.changedTouches[0].screenX;
        });

        sidebar.addEventListener('touchend', (e) => {
            touchEndX = e.changedTouches[0].screenX;
            if (touchStartX - touchEndX > 50 && isSidebarOpen) {
                toggleSidebar();
            }
        });

        function addFilters() {
            const filterDiv = document.querySelector('.filter');
            const inStockFilter = document.createElement('div');
            inStockFilter.className = 'mandala-select';
            inStockFilter.innerHTML = `
                <button class="mandala-button" id="stock-button" data-i18n="stock-all">Наличие: Все</button>
                <div class="mandala-options" id="stock-options">
                    <div onclick="selectStock('all')" data-i18n="stock-all-option">Все</div>
                    <div onclick="selectStock('in-stock')" data-i18n="in-stock">В наличии</div>
                    <div onclick="selectStock('out-of-stock')" data-i18n="out-of-stock">Нет в наличии</div>
                </div>
            `;
            const discountFilter = document.createElement('div');
            discountFilter.className = 'mandala-select';
            discountFilter.innerHTML = `
                <button class="mandala-button" id="discount-button" data-i18n="discount-all">Скидки: Все</button>
                <div class="mandala-options" id="discount-options">
                    <div onclick="selectDiscount('all')" data-i18n="discount-all-option">Все</div>
                    <div onclick="selectDiscount('with-discount')" data-i18n="with-discount">Со скидкой</div>
                    <div onclick="selectDiscount('no-discount')" data-i18n="no-discount">Без скидки</div>
                </div>
            `;
            filterDiv.appendChild(inStockFilter);
            filterDiv.appendChild(discountFilter);

            setLanguage(currentLanguage);
        }

        function selectStock(stock) {
            selectedStock = stock;
            document.querySelector('#stock-options').style.display = 'none';
            const stockButton = document.getElementById('stock-button');
            const stockText = stock === 'all' ? translations[currentLanguage]['stock-all-option'] : translations[currentLanguage][stock];
            stockButton.innerText = `${translations[currentLanguage]['stock-all'].split(':')[0]}: ${stockText}`;
            filterProducts();
        }

        function selectDiscount(discount) {
            selectedDiscount = discount;
            document.querySelector('#discount-options').style.display = 'none';
            const discountButton = document.getElementById('discount-button');
            const discountText = discount === 'all' ? translations[currentLanguage]['discount-all-option'] : translations[currentLanguage][discount];
            discountButton.innerText = `${translations[currentLanguage]['discount-all'].split(':')[0]}: ${discountText}`;
            filterProducts();
        }

        window.onload = function() {
            const loader = document.getElementById('loader');
            loader.style.display = 'block';
            setTimeout(() => {
                loader.style.display = 'none';
                initProducts();
                checkAuth();
                toggleSection('catalog');
                setLanguage('ru');
                addFilters();
            }, 1000);
        };
    </script>
</body>
</html>
