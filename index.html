<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dark Thailand</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        body {
            background: #1a1a1a;
            color: #ff4444;
            overflow-x: hidden;
            font-size: 14px;
            line-height: 1.5;
        }
        .container {
            max-width: 100%;
            padding: 10px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            padding: 15px 0;
        }
        .logo {
            font-size: 28px;
            color: #ff4444;
            text-shadow: 0 0 10px #ff4444;
            animation: glow 2s infinite alternate;
        }
        @keyframes glow {
            0% { text-shadow: 0 0 5px #ff4444; }
            100% { text-shadow: 0 0 15px #ff4444, 0 0 20px #ff0000; }
        }
        .slogan {
            font-size: 16px;
            color: #ff6666;
            margin-top: 5px;
        }
        .referral-teaser {
            margin-top: 10px;
            font-size: 14px;
        }
        .referral-teaser button {
            background: #ff4444;
            border: none;
            padding: 5px 10px;
            color: #fff;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .referral-teaser button:hover {
            background: #ff6666;
        }
        .menu {
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            background: #2b2b2b;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        .menu button {
            background: none;
            border: none;
            color: #ff4444;
            font-size: 20px;
            padding: 8px 15px;
            cursor: pointer;
            transition: transform 0.2s, color 0.2s;
        }
        .menu button:hover {
            transform: scale(1.1);
            color: #ff6666;
        }
        .tab-content, .profile-menu, .vacancy-menu, .mail-menu {
            display: none;
            background: #2b2b2b;
            padding: 10px;
            border-radius: 5px;
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .tabs {
            display: flex;
            justify-content: space-around;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        .tab {
            background: #333;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s, box-shadow 0.3s;
            margin: 2px;
        }
        .tab.active, .tab:hover {
            background: #ff4444;
            color: #fff;
            box-shadow: 0 0 10px #ff4444;
        }
        .product-card {
            background: #333;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .product-card:hover {
            transform: scale(1.02);
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease-in;
        }
        .modal-content {
            background: #2b2b2b;
            padding: 15px;
            border-radius: 5px;
            color: #ff4444;
            max-width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 0 15px rgba(255, 68, 68, 0.3);
        }
        .buy-button, .preorder-button {
            background: #ff4444;
            border: none;
            padding: 8px 15px;
            color: #fff;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s, box-shadow 0.3s;
        }
        .buy-button:hover, .preorder-button:hover {
            background: #ff6666;
            box-shadow: 0 0 10px #ff4444;
        }
        .preorder-button {
            background: #555;
        }
        .preorder-button:hover {
            background: #777;
        }
        .position, .review, .moderator-response {
            margin: 5px 0;
        }
        .custom-select {
            position: relative;
            display: inline-block;
            width: 48%;
            margin: 5px 1%;
        }
        .custom-select select {
            width: 100%;
            padding: 8px;
            background: #333;
            border: 1px solid #ff4444;
            color: #fff;
            border-radius: 5px;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            cursor: pointer;
        }
        .custom-select::after {
            content: '‚ñº';
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #ff4444;
            pointer-events: none;
        }
        .custom-input {
            width: 100%;
            padding: 10px;
            background: #333;
            border: 1px solid #ff4444;
            color: #fff;
            border-radius: 5px;
            margin: 10px 0;
        }
        .custom-input:focus {
            outline: none;
            box-shadow: 0 0 10px #ff4444;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="logo">Dark Thailand</h1>
            <p class="slogan">–í–∞—à –Ω–∞–¥—ë–∂–Ω—ã–π —à–æ–ø –≤ –¢–∞–∏–ª–∞–Ω–¥–µ</p>
            <div class="referral-teaser">
                –ü—Ä–∏–≥–ª–∞—à–∞–π –¥—Ä—É–∑–µ–π –∏ –ø–æ–ª—É—á–∞–π –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Å—Ç–∞—Ñ—Ñ! 
                <button onclick="showReferralDetails()">–ü–æ–¥—Ä–æ–±–Ω–µ–µ...</button>
            </div>
        </div>
        <div class="menu">
            <button onclick="toggleCatalog()">üìö</button>
            <button onclick="toggleVacancies()">üíº</button>
            <button onclick="toggleMail()">‚úâÔ∏è</button>
            <button onclick="toggleProfile()">üíÄ</button>
        </div>
        <div id="catalogMenu" class="tab-content">
            <div class="custom-select">
                <select id="citySelect" onchange="filterByCity()">
                    <option value="all">–í—Å–µ –≥–æ—Ä–æ–¥–∞</option>
                    <option value="phuket">–ü—Ö—É–∫–µ—Ç</option>
                    <option value="pattaya">–ü–∞—Ç—Ç–∞–π—è</option>
                    <option value="bangkok">–ë–∞–Ω–≥–∫–æ–∫</option>
                    <option value="samui">–æ. –°–∞–º—É–∏</option>
                </select>
            </div>
            <div class="custom-select">
                <select id="districtSelect" onchange="filterByDistrict()">
                    <option value="all">–í—Å–µ —Ä–∞–π–æ–Ω—ã</option>
                </select>
            </div>
            <div class="tabs">
                <div class="tab active" data-tab="hash" onclick="showTab('hash')">–•—ç—à</div>
                <div class="tab" data-tab="coke" onclick="showTab('coke')">–ö–æ–∫—Å</div>
                <div class="tab" data-tab="amph" onclick="showTab('amph')">–ê–º—Ñ</div>
                <div class="tab" data-tab="meth" onclick="showTab('meth')">–ú–µ—Ñ</div>
                <div class="tab" data-tab="meph" onclick="showTab('meph')">–ú–µ—Ç</div>
                <div class="tab" data-tab="heroin" onclick="showTab('heroin')">–ì–µ—Ä—ã—á</div>
            </div>
            <div id="hash" class="tab-content" style="display: block;">
                <div class="product-card" data-product="hash-1" onclick="showProductModal('hash', 1)">–ß—ë—Ä–Ω—ã–π –ê—Ñ–≥–∞–Ω (VHQ)</div>
                <div class="product-card" data-product="hash-2" onclick="showProductModal('hash', 2)">–ó–µ–ª—ë–Ω—ã–π –ú–∞—Ä–æ–∫–∫–æ (HQ)</div>
                <div class="product-card" data-product="hash-3" onclick="showProductModal('hash', 3)">–ö–æ—Ä–∏—á–Ω–µ–≤—ã–π –î—ã–º (MQ)</div>
                <div class="product-card" data-product="hash-4" onclick="showProductModal('hash', 4)">–¢—ë–º–Ω—ã–π –ü–µ—Å–æ–∫ (LQ)</div>
                <div class="product-card" data-product="hash-5" onclick="showProductModal('hash', 5)">–°–µ–≤–µ—Ä–Ω—ã–π –®—Ç–æ—Ä–º (VHQ)</div>
            </div>
            <div id="coke" class="tab-content">
                <div class="product-card" data-product="coke-1" onclick="showProductModal('coke', 1)">–¢—Ä–æ–ø–∏–∫ –ë–∏—á (Fishscale)</div>
                <div class="product-card" data-product="coke-2" onclick="showProductModal('coke', 2)">–ë–µ–ª—ã–π –ü—Ä–∞—Ö (VHQ)</div>
                <div class="product-card" data-product="coke-3" onclick="showProductModal('coke', 3)">–°–Ω–µ–∂–Ω—ã–π –í–µ—Ç–µ—Ä (HQ)</div>
                <div class="product-card" data-product="coke-4" onclick="showProductModal('coke', 4)">–ì—Ä—è–∑–Ω—ã–π –°–Ω–µ–≥ (MQ)</div>
                <div class="product-card" data-product="coke-5" onclick="showProductModal('coke', 5)">–£–ª–∏—á–Ω–∞—è –ü—ã–ª—å (LQ)</div>
            </div>
            <div id="amph" class="tab-content">
                <div class="product-card" data-product="amph-1" onclick="showProductModal('amph', 1)">–ë–µ–ª–∞—è –ú–æ–ª–Ω–∏—è (VHQ)</div>
                <div class="product-card" data-product="amph-2" onclick="showProductModal('amph', 2)">–ö—Ä–∞—Å–Ω—ã–π –®—Ç–æ—Ä–º (HQ)</div>
                <div class="product-card" data-product="amph-3" onclick="showProductModal('amph', 3)">–ñ—ë–ª—Ç—ã–π –ü–µ–ø–µ–ª (MQ)</div>
                <div class="product-card" data-product="amph-4" onclick="showProductModal('amph', 4)">–°–µ—Ä—ã–π –î—ã–º (LQ)</div>
                <div class="product-card" data-product="amph-5" onclick="showProductModal('amph', 5)">–°–∏–Ω–∏–π –£–¥–∞—Ä (VHQ)</div>
            </div>
            <div id="meth" class="tab-content">
                <div class="product-card" data-product="meth-1" onclick="showProductModal('meth', 1)">–ö—Ä–∏—Å—Ç–∞–ª–ª –ì–æ—Ä—ã (VHQ)</div>
                <div class="product-card" data-product="meth-2" onclick="showProductModal('meth', 2)">–°–∏–Ω–∏–π –õ—ë–¥ (HQ)</div>
                <div class="product-card" data-product="meth-3" onclick="showProductModal('meth', 3)">–ë–µ–ª—ã–π –ö—Ä–∏—Å—Ç–∞–ª–ª (MQ)</div>
                <div class="product-card" data-product="meth-4" onclick="showProductModal('meth', 4)">–ì—Ä—è–∑–Ω—ã–π –õ—ë–¥ (LQ)</div>
                <div class="product-card" data-product="meth-5" onclick="showProductModal('meth', 5)">–ñ—ë–ª—Ç—ã–π –ö—Ä–∏—Å—Ç–∞–ª–ª (VHQ)</div>
            </div>
            <div id="meph" class="tab-content">
                <div class="product-card" data-product="meph-1" onclick="showProductModal('meph', 1)">–†–æ–∑–æ–≤—ã–π –ö–∞–π—Ñ (VHQ)</div>
                <div class="product-card" data-product="meph-2" onclick="showProductModal('meph', 2)">–ë–µ–ª—ã–π –í–∑—Ä—ã–≤ (HQ)</div>
                <div class="product-card" data-product="meph-3" onclick="showProductModal('meph', 3)">–°–µ—Ä—ã–π –ü–æ—Ä–æ—à–æ–∫ (MQ)</div>
                <div class="product-card" data-product="meph-4" onclick="showProductModal('meph', 4)">–ú—É—Ç–Ω—ã–π –ö–∞–π—Ñ (LQ)</div>
                <div class="product-card" data-product="meph-5" onclick="showProductModal('meph', 5)">–ö—Ä–∞—Å–Ω—ã–π –í–∑—Ä—ã–≤ (VHQ)</div>
            </div>
            <div id="heroin" class="tab-content">
                <div class="product-card" data-product="heroin-1" onclick="showProductModal('heroin', 1)">–ö–æ—Ä–∏—á–Ω–µ–≤—ã–π –°–æ–Ω (VHQ)</div>
                <div class="product-card" data-product="heroin-2" onclick="showProductModal('heroin', 2)">–ë–µ–ª—ã–π –î—Ä–∞–∫–æ–Ω (HQ)</div>
                <div class="product-card" data-product="heroin-3" onclick="showProductModal('heroin', 3)">–¢—ë–º–Ω—ã–π –ü–æ—Ä–æ—à–æ–∫ (MQ)</div>
                <div class="product-card" data-product="heroin-4" onclick="showProductModal('heroin', 4)">–ì—Ä—è–∑–Ω—ã–π –°–æ–Ω (LQ)</div>
                <div class="product-card" data-product="heroin-5" onclick="showProductModal('heroin', 5)">–ß—ë—Ä–Ω—ã–π –î—Ä–∞–∫–æ–Ω (VHQ)</div>
            </div>
        </div>
        <div id="profileMenu" class="profile-menu">
            <h2 id="userName"></h2>
            <p>–ë–∞–ª–∞–Ω—Å: <span id="balance">0 ‡∏ø</span></p>
            <p>–ó–∞–∫–∞–∑–æ–≤: <span id="orderCount">0</span></p>
            <p>–ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ –¥—Ä—É–∑–µ–π: <span id="referralCount">0</span></p>
            <p>–ü—Ä–∏–≥–ª–∞—à–∞–π –¥—Ä—É–∑–µ–π –∏ –ø–æ–ª—É—á–∞–π –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Å—Ç–∞—Ñ—Ñ! <button class="buy-button" onclick="showReferralDetails()">–ü–æ–¥—Ä–æ–±–Ω–µ–µ...</button></p>
            <button class="buy-button" onclick="showDepositModal('BTC')">–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å</button>
            <h3>–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤:</h3>
            <div id="orderList"></div>
        </div>
        <div id="vacancyMenu" class="vacancy-menu">
            <h2>–í–∞–∫–∞–Ω—Å–∏–∏</h2>
            <p>–ö—É—Ä—å–µ—Ä - –æ—Ç 50,000 ‡∏ø/–º–µ—Å <button class="buy-button" onclick="applyForJob('–ö—É—Ä—å–µ—Ä')">–û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button></p>
            <p>–ö–ª–∞–¥–º–µ–Ω - –æ—Ç 80,000 ‡∏ø/–º–µ—Å <button class="buy-button" onclick="applyForJob('–ö–ª–∞–¥–º–µ–Ω')">–û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button></p>
            <p>–ü–µ—Ä–µ–≤–æ–∑—á–∏–∫ - –æ—Ç 120,000 ‡∏ø/–º–µ—Å <button class="buy-button" onclick="applyForJob('–ü–µ—Ä–µ–≤–æ–∑—á–∏–∫')">–û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button></p>
            <p>SMM-—â–∏–∫ - –æ—Ç 40,000 ‡∏ø/–º–µ—Å <button class="buy-button" onclick="applyForJob('SMM-—â–∏–∫')">–û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button></p>
        </div>
        <div id="mailMenu" class="mail-menu">
            <h2>–ü–æ—á—Ç–∞</h2>
            <div id="mailList"></div>
        </div>
        <div class="modal" id="registrationModal">
            <div class="modal-content">
                <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
                <input type="text" id="regNickname" class="custom-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫–Ω–µ–π–º">
                <button class="buy-button" onclick="registerUser()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                <p id="regError" style="color: #ff6666;"></p>
            </div>
        </div>
        <div class="modal" id="productModal">
            <div class="modal-content" id="productContent"></div>
        </div>
        <div class="modal" id="paymentModal">
            <div class="modal-content" id="paymentContent"></div>
        </div>
        <div class="modal" id="preorderModal">
            <div class="modal-content" id="preorderContent"></div>
        </div>
        <div class="modal" id="depositModal">
            <div class="modal-content" id="depositContent"></div>
        </div>
        <div class="modal" id="customModal">
            <div class="modal-content" id="customContent"></div>
        </div>
        <div class="modal" id="confirmModal">
            <div class="modal-content" id="confirmContent"></div>
        </div>
    </div>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
    window.Telegram.WebApp.ready();
    window.Telegram.WebApp.expand();

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    let balance = 0;
    let orderCount = 0;
    let referralCount = 0;
    let referralDeposits = 0;
    let orderHistory = [];
    let selectedCity = 'all';
    let selectedDistrict = 'all';
    let currentUser = null;
    let mailMessages = [];
    let pendingPayments = {};
    let BTC_RATE = 2000000;
    let products = null; // –ü–æ–∫–∞ null, —á—Ç–æ–±—ã —è–≤–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ

    const BOT_B_TOKEN = '7589545725:AAHoedAqoGh_k0WWdUs1rcBN1yddUtBFhsk';
    const ADMIN_CHAT_ID = '5956080955';

    const testAddresses = {
        BTC: "1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa",
        ETH: "0x32Be343B94f860124dC4fEe278FDCBD38C102D88",
        USDT: "0xdAC17F958D2ee523a2206206994597C13D831ec7",
        SOL: "5yK7e5a8j9k2m3n4p5q6r7s8t9u0v1w2x3y4z5A6B7C8D9E0F1G2H",
        TON: "EQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAM9c"
    };

    // –î–∞–Ω–Ω—ã–µ (–æ–±—ä—è–≤–ª—è–µ–º —Å—Ä–∞–∑—É)
    const cities = {
        "phuket": {
            "–ü–∞—Ç–æ–Ω–≥": { lat: "7.891", lon: "98.298", desc: "–ü–æ–¥ –ø–∞–ª—å–º–æ–π —É —Ç—Ä–µ—Ç—å–µ–≥–æ —à–µ–∑–ª–æ–Ω–≥–∞, –∑–∞–∫–æ–ø–∞–Ω–æ –≤ –ø–µ—Å–∫–µ, —á—ë—Ä–Ω—ã–π –ø–∞–∫–µ—Ç." },
            "–ö–∞—Ä–æ–Ω": { lat: "7.846", lon: "98.295", desc: "–ü–æ–¥ –∫–∞–º–Ω–µ–º —É –∑–∞–±–æ—Ä–∞, –º–∞–≥–Ω–∏—Ç –≤ —Å–∏–Ω–µ–π –∏–∑–æ–ª–µ–Ω—Ç–µ." },
            "–ü—Ö—É–∫–µ—Ç-—Ç–∞—É–Ω": { lat: "7.883", lon: "98.391", desc: "–í –∫—É—Å—Ç–∞—Ö –∑–∞ —Å—Ç–∞—Ä—ã–º –ª–∞—Ä—å–∫–æ–º, –∑–∞–≤—ë—Ä–Ω—É—Ç–æ –≤ –∑–µ–ª—ë–Ω—É—é –ø–ª—ë–Ω–∫—É." },
            "–ö–∞—Ç–∞": { lat: "7.820", lon: "98.299", desc: "–ü–æ–¥ —Å–∫–∞–º–µ–π–∫–æ–π —É –ø–ª—è–∂–∞, –∑–∞–≤—ë—Ä–Ω—É—Ç–æ –≤ —á—ë—Ä–Ω—É—é –ø–ª—ë–Ω–∫—É." }
        },
        "pattaya": {
            "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ü–∞—Ç—Ç–∞–π—è": { lat: "12.935", lon: "100.887", desc: "–í —â–µ–ª–∏ —Å—Ç–µ–Ω—ã —É –±–∞—Ä–∞, –º–∞–≥–Ω–∏—Ç –≤ –∫—Ä–∞—Å–Ω–æ–π –∏–∑–æ–ª–µ–Ω—Ç–µ." },
            "–î–∂–æ–º—Ç—å–µ–Ω": { lat: "12.903", lon: "100.869", desc: "–ü–æ–¥ –∫—É—Å—Ç–æ–º —É –¥–æ—Ä–æ–≥–∏, –∑–∞–≤—ë—Ä–Ω—É—Ç–æ –≤ —Å–µ—Ä—É—é —Ç–∫–∞–Ω—å." },
            "–ù–∞–∫–ª—É–∞": { lat: "12.970", lon: "100.900", desc: "–ó–∞ –º—É—Å–æ—Ä–∫–æ–π —É —Ä—ã–Ω–∫–∞, —á—ë—Ä–Ω—ã–π –ø–∞–∫–µ—Ç." },
            "–Æ–∂–Ω–∞—è –ü–∞—Ç—Ç–∞–π—è": { lat: "12.923", lon: "100.882", desc: "–ü–æ–¥ –∫–∞–º–Ω–µ–º —É –ø–∏—Ä—Å–∞, –∑–∞–≤—ë—Ä–Ω—É—Ç–æ –≤ –∑–µ–ª—ë–Ω—É—é –ø–ª—ë–Ω–∫—É." }
        },
        "bangkok": {
            "–°—É–∫—Ö—É–º–≤–∏—Ç": { lat: "13.736", lon: "100.561", desc: "–í —â–µ–ª–∏ —Å—Ç–µ–Ω—ã —É –º–µ—Ç—Ä–æ, –º–∞–≥–Ω–∏—Ç –≤ –∂—ë–ª—Ç–æ–π –∏–∑–æ–ª–µ–Ω—Ç–µ." },
            "–ö–∞–æ—Å–∞–Ω": { lat: "13.759", lon: "100.497", desc: "–ü–æ–¥ —Å–∫–∞–º–µ–π–∫–æ–π —É —Ö–æ—Å—Ç–µ–ª–∞, –∑–∞–≤—ë—Ä–Ω—É—Ç–æ –≤ —á—ë—Ä–Ω—É—é –ø–ª—ë–Ω–∫—É." },
            "–°–∏–ª–æ–º": { lat: "13.723", lon: "100.535", desc: "–ó–∞ –≤—ã–≤–µ—Å–∫–æ–π —É –±–∞—Ä–∞, –º–∞–≥–Ω–∏—Ç –≤ —Å–∏–Ω–µ–π –∏–∑–æ–ª–µ–Ω—Ç–µ." },
            "–ß–∞—Ç—É—á–∞–∫": { lat: "13.799", lon: "100.548", desc: "–í –∫—É—Å—Ç–∞—Ö —É —Ä—ã–Ω–∫–∞, –∑–∞–≤—ë—Ä–Ω—É—Ç–æ –≤ —Å–µ—Ä—É—é —Ç–∫–∞–Ω—å." }
        },
        "samui": {
            "–ß–∞–≤–µ–Ω–≥": { lat: "9.520", lon: "100.057", desc: "–ü–æ–¥ —à–µ–∑–ª–æ–Ω–≥–æ–º —É –±–∞—Ä–∞, –∑–∞–≤—ë—Ä–Ω—É—Ç–æ –≤ —á—ë—Ä–Ω—ã–π –ø–∞–∫–µ—Ç." },
            "–õ–∞–º–∞–π": { lat: "9.470", lon: "100.047", desc: "–í –∫—É—Å—Ç–∞—Ö —É –¥–æ—Ä–æ–≥–∏, –º–∞–≥–Ω–∏—Ç –≤ –∑–µ–ª—ë–Ω–æ–π –∏–∑–æ–ª–µ–Ω—Ç–µ." },
            "–ë–æ –ü—Ö—É—Ç": { lat: "9.560", lon: "100.031", desc: "–ü–æ–¥ –∫–∞–º–Ω–µ–º —É –ø–∏—Ä—Å–∞, –∑–∞–≤—ë—Ä–Ω—É—Ç–æ –≤ —Å–µ—Ä—É—é —Ç–∫–∞–Ω—å." },
            "–ú–∞–µ–Ω–∞–º": { lat: "9.573", lon: "100.000", desc: "–ó–∞ –º—É—Å–æ—Ä–∫–æ–π —É –ø–ª—è–∂–∞, —á—ë—Ä–Ω—ã–π –ø–∞–∫–µ—Ç." }
        }
    };

    const weights = {
        default: [1, 2, 3, 5, 10, 15, 20],
        cokeMeph: [0.5, 1, 2, 3, 5, 10, 15, 20]
    };

    const basePrices = {
        hash: { 1: 900, 2: 700, 3: 500, 4: 400, 5: 1000 },
        coke: { 1: 4000, 2: 3600, 3: 3000, 4: 2400, 5: 2000 },
        amph: { 1: 1300, 2: 1000, 3: 900, 4: 700, 5: 1500 },
        meth: { 1: 1500, 2: 1200, 3: 1000, 4: 800, 5: 1800 },
        meph: { 1: 1400, 2: 1100, 3: 900, 4: 700, 5: 1600 },
        heroin: { 1: 2000, 2: 1800, 3: 1500, 4: 1200, 5: 2500 }
    };

    // –§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ–∑–∏—Ü–∏–π
    function generatePositions(category, productId) {
        const isCokeOrMeph = category === 'coke' || category === 'meph';
        const applicableWeights = isCokeOrMeph ? weights.cokeMeph : weights.default;
        const positions = [];
        let id = 1;

        for (const city in cities) {
            for (const district in cities[city]) {
                applicableWeights.forEach(weight => {
                    const basePricePerGram = basePrices[category][productId];
                    const price = Math.round(basePricePerGram * weight * (city === 'samui' ? 1.5 : 1));
                    const cryptoPrice = (price / BTC_RATE).toFixed(5);
                    const inStock = (isCokeOrMeph && weight === 0.5) || Math.random() > 0.2;
                    positions.push({
                        id: id++,
                        weight,
                        price,
                        cryptoPrice,
                        city,
                        district,
                        inStock
                    });
                });
            }
        }
        return positions;
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
    function initializeData() {
        products = {
            hash: {
                1: { name: "–ß—ë—Ä–Ω—ã–π –ê—Ñ–≥–∞–Ω (VHQ)", positions: generatePositions('hash', 1), reviews: [{ text: "–ß—ë—Ä–Ω—ã–π –ê—Ñ–≥–∞–Ω ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –∫–æ—Å–º–æ—Å! –ú—è–≥–∫–∏–π –∏ –º–æ—â–Ω—ã–π, —Ç–æ–ø –∑–∞ —Å–≤–æ–∏ –¥–µ–Ω—å–≥–∏! ‚Äî –ê–Ω–æ–Ω–∏–º", mod: `–†–∞–¥—ã, —á—Ç–æ –≤–∞–º –ø–æ–Ω—Ä–∞–≤–∏–ª—Å—è –ß—ë—Ä–Ω—ã–π –ê—Ñ–≥–∞–Ω! –ó–∞—Ö–æ–¥–∏—Ç–µ –µ—â—ë, –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª –≤–∞–º –ø—Ä–æ–º–æ–∫–æ–¥ –Ω–∞ ${getRandomPromoGood()} –∑–∞ –∫—Ä—É—Ç–æ–π –æ—Ç–∑—ã–≤! ‚Äî –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä Dark Thailand` }] },
                2: { name: "–ó–µ–ª—ë–Ω—ã–π –ú–∞—Ä–æ–∫–∫–æ (HQ)", positions: generatePositions('hash', 2), reviews: [] },
                3: { name: "–ö–æ—Ä–∏—á–Ω–µ–≤—ã–π –î—ã–º (MQ)", positions: generatePositions('hash', 3), reviews: [] },
                4: { name: "–¢—ë–º–Ω—ã–π –ü–µ—Å–æ–∫ (LQ)", positions: generatePositions('hash', 4), reviews: [] },
                5: { name: "–°–µ–≤–µ—Ä–Ω—ã–π –®—Ç–æ—Ä–º (VHQ)", positions: generatePositions('hash', 5), reviews: [] }
            },
            coke: {
                1: { name: "–¢—Ä–æ–ø–∏–∫ –ë–∏—á (Fishscale)", positions: generatePositions('coke', 1), reviews: [] },
                2: { name: "–ë–µ–ª—ã–π –ü—Ä–∞—Ö (VHQ)", positions: generatePositions('coke', 2), reviews: [] },
                3: { name: "–°–Ω–µ–∂–Ω—ã–π –í–µ—Ç–µ—Ä (HQ)", positions: generatePositions('coke', 3), reviews: [] },
                4: { name: "–ì—Ä—è–∑–Ω—ã–π –°–Ω–µ–≥ (MQ)", positions: generatePositions('coke', 4), reviews: [] },
                5: { name: "–£–ª–∏—á–Ω–∞—è –ü—ã–ª—å (LQ)", positions: generatePositions('coke', 5), reviews: [] }
            },
            amph: {
                1: { name: "–ë–µ–ª–∞—è –ú–æ–ª–Ω–∏—è (VHQ)", positions: generatePositions('amph', 1), reviews: [] },
                2: { name: "–ö—Ä–∞—Å–Ω—ã–π –®—Ç–æ—Ä–º (HQ)", positions: generatePositions('amph', 2), reviews: [] },
                3: { name: "–ñ—ë–ª—Ç—ã–π –ü–µ–ø–µ–ª (MQ)", positions: generatePositions('amph', 3), reviews: [] },
                4: { name: "–°–µ—Ä—ã–π –î—ã–º (LQ)", positions: generatePositions('amph', 4), reviews: [] },
                5: { name: "–°–∏–Ω–∏–π –£–¥–∞—Ä (VHQ)", positions: generatePositions('amph', 5), reviews: [] }
            },
            meth: {
                1: { name: "–ö—Ä–∏—Å—Ç–∞–ª–ª –ì–æ—Ä—ã (VHQ)", positions: generatePositions('meth', 1), reviews: [] },
                2: { name: "–°–∏–Ω–∏–π –õ—ë–¥ (HQ)", positions: generatePositions('meth', 2), reviews: [] },
                3: { name: "–ë–µ–ª—ã–π –ö—Ä–∏—Å—Ç–∞–ª–ª (MQ)", positions: generatePositions('meth', 3), reviews: [] },
                4: { name: "–ì—Ä—è–∑–Ω—ã–π –õ—ë–¥ (LQ)", positions: generatePositions('meth', 4), reviews: [] },
                5: { name: "–ñ—ë–ª—Ç—ã–π –ö—Ä–∏—Å—Ç–∞–ª–ª (VHQ)", positions: generatePositions('meth', 5), reviews: [] }
            },
            meph: {
                1: { name: "–†–æ–∑–æ–≤—ã–π –ö–∞–π—Ñ (VHQ)", positions: generatePositions('meph', 1), reviews: [] },
                2: { name: "–ë–µ–ª—ã–π –í–∑—Ä—ã–≤ (HQ)", positions: generatePositions('meph', 2), reviews: [] },
                3: { name: "–°–µ—Ä—ã–π –ü–æ—Ä–æ—à–æ–∫ (MQ)", positions: generatePositions('meph', 3), reviews: [] },
                4: { name: "–ú—É—Ç–Ω—ã–π –ö–∞–π—Ñ (LQ)", positions: generatePositions('meph', 4), reviews: [] },
                5: { name: "–ö—Ä–∞—Å–Ω—ã–π –í–∑—Ä—ã–≤ (VHQ)", positions: generatePositions('meph', 5), reviews: [] }
            },
            heroin: {
                1: { name: "–ö–æ—Ä–∏—á–Ω–µ–≤—ã–π –°–æ–Ω (VHQ)", positions: generatePositions('heroin', 1), reviews: [] },
                2: { name: "–ë–µ–ª—ã–π –î—Ä–∞–∫–æ–Ω (HQ)", positions: generatePositions('heroin', 2), reviews: [] },
                3: { name: "–¢—ë–º–Ω—ã–π –ü–æ—Ä–æ—à–æ–∫ (MQ)", positions: generatePositions('heroin', 3), reviews: [] },
                4: { name: "–ì—Ä—è–∑–Ω—ã–π –°–æ–Ω (LQ)", positions: generatePositions('heroin', 4), reviews: [] },
                5: { name: "–ß—ë—Ä–Ω—ã–π –î—Ä–∞–∫–æ–Ω (VHQ)", positions: generatePositions('heroin', 5), reviews: [] }
            }
        };
    }

    // –§—É–Ω–∫—Ü–∏–∏
    async function fetchBTCRate() {
        try {
            const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=thb');
            const data = await response.json();
            BTC_RATE = data.bitcoin.thb;
            console.log(`–ê–∫—Ç—É–∞–ª—å–Ω—ã–π –∫—É—Ä—Å BTC/THB: ${BTC_RATE}`);
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫—É—Ä—Å–∞ BTC:', error);
            BTC_RATE = 2000000;
        }
    }

    function getRandomDate() {
        const day = Math.floor(Math.random() * 12) + 1;
        return `0${day}.03.2025`.slice(-10);
    }

    function getRandomPromoGood() {
        const promos = ["5%", "10%", "15%"];
        return promos[Math.floor(Math.random() * promos.length)];
    }

    function getRandomCoordinates(city, district) {
        const baseLat = parseFloat(cities[city][district].lat);
        const baseLon = parseFloat(cities[city][district].lon);
        const offset = 0.005;
        const randomLat = (baseLat + (Math.random() * offset * 2 - offset)).toFixed(3);
        const randomLon = (baseLon + (Math.random() * offset * 2 - offset)).toFixed(3);
        return { lat: randomLat, lon: randomLon };
    }

    function toggleCatalog() {
        if (!products) {
            window.Telegram.WebApp.showAlert('–î–∞–Ω–Ω—ã–µ –µ—â—ë –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è, –ø–æ–¥–æ–∂–¥–∏—Ç–µ!');
            return;
        }
        const catalog = document.getElementById('catalogMenu');
        const profile = document.getElementById('profileMenu');
        const vacancies = document.getElementById('vacancyMenu');
        const mail = document.getElementById('mailMenu');
        catalog.style.display = catalog.style.display === 'block' ? 'none' : 'block';
        profile.style.display = 'none';
        vacancies.style.display = 'none';
        mail.style.display = 'none';
        if (catalog.style.display === 'block') {
            showTab('hash');
        }
    }

    function toggleVacancies() {
        const catalog = document.getElementById('catalogMenu');
        const profile = document.getElementById('profileMenu');
        const vacancies = document.getElementById('vacancyMenu');
        const mail = document.getElementById('mailMenu');
        vacancies.style.display = vacancies.style.display === 'block' ? 'none' : 'block';
        catalog.style.display = 'none';
        profile.style.display = 'none';
        mail.style.display = 'none';
    }

    function toggleMail() {
        const catalog = document.getElementById('catalogMenu');
        const profile = document.getElementById('profileMenu');
        const vacancies = document.getElementById('vacancyMenu');
        const mail = document.getElementById('mailMenu');
        mail.style.display = mail.style.display === 'block' ? 'none' : 'block';
        catalog.style.display = 'none';
        profile.style.display = 'none';
        vacancies.style.display = 'none';
        updateMail();
    }

    function toggleProfile() {
        const catalog = document.getElementById('catalogMenu');
        const profile = document.getElementById('profileMenu');
        const vacancies = document.getElementById('vacancyMenu');
        const mail = document.getElementById('mailMenu');
        profile.style.display = profile.style.display === 'block' ? 'none' : 'block';
        catalog.style.display = 'none';
        vacancies.style.display = 'none';
        mail.style.display = 'none';
        updateProfile();
    }

    function updateProfile() {
        if (!currentUser) return;
        document.getElementById('userName').textContent = currentUser;
        document.getElementById('balance').textContent = `${balance} ‡∏ø`;
        document.getElementById('orderCount').textContent = orderCount;
        document.getElementById('referralCount').textContent = referralCount;
        const orderList = document.getElementById('orderList');
        orderList.innerHTML = orderHistory.length > 0 ? orderHistory.map(order => `<p>${order.date}: ${order.product} - ${order.price} ‡∏ø</p>`).join('') : '–ü–æ–∫–∞ –ø—É—Å—Ç–æ, –¥–µ–ª–∞–π –∑–∞–∫–∞–∑—ã!';
        checkReferralBonus();
    }

    function sendToTelegramBot(message, paymentId, amount) {
        const chatId = window.Telegram.WebApp.initDataUnsafe.user?.id || 'unknown';
        const fullMessage = `${message}\nchat_id: ${chatId}`;
        const keyboard = paymentId ? {
            inline_keyboard: [
                [
                    { text: '‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å', callback_data: `confirm_${paymentId}_${amount}_${chatId}` },
                    { text: '‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å', callback_data: `reject_${paymentId}_${chatId}` }
                ]
            ]
        } : null;
        fetch(`https://api.telegram.org/bot${BOT_B_TOKEN}/sendMessage`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                chat_id: ADMIN_CHAT_ID,
                text: fullMessage,
                reply_markup: keyboard
            })
        })
            .then(response => response.json())
            .then(data => console.log('–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ:', data))
            .catch(error => console.error('–û—à–∏–±–∫–∞:', error));
    }

    function confirmPayment(crypto, address, amount) {
        const paymentId = `${currentUser}_${Date.now()}`;
        pendingPayments[paymentId] = { user: currentUser, amount: parseInt(amount) };
        sendToTelegramBot(`üí∏ –ó–∞–ø—Ä–æ—Å –Ω–∞ –æ–ø–ª–∞—Ç—É:\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${currentUser}\n–ö—Ä–∏–ø—Ç–∞: ${crypto}\n–ê–¥—Ä–µ—Å: ${address}\n–°—É–º–º–∞: ${amount} ‡∏ø`, paymentId, amount);
        const modal = document.getElementById('confirmModal');
        const content = document.getElementById('confirmContent');
        content.innerHTML = `
            <h2>–û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</h2>
            <p>–ó–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –Ω–∞ ${amount} ‡∏ø (~${(amount / BTC_RATE).toFixed(5)} BTC) –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω.</p>
            <p>–û–∂–∏–¥–∞–π—Ç–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.</p>
            <button class="buy-button" onclick="document.getElementById('confirmModal').style.display='none';">–ó–∞–∫—Ä—ã—Ç—å</button>
        `;
        modal.style.display = 'flex';
        document.getElementById('depositModal').style.display = 'none';
        modal.onclick = (e) => {
            if (e.target === modal) modal.style.display = 'none';
        };
    }

    function checkPendingPayment(paymentId, amount) {
        if (pendingPayments[paymentId]) {
            balance += amount;
            referralDeposits += amount;
            delete pendingPayments[paymentId];
            updateProfile();
            addMailMessage(`üí∞ –ë–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω–µ–Ω –Ω–∞ ${amount} ‡∏ø`);
            window.Telegram.WebApp.showAlert(`–ë–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω–µ–Ω –Ω–∞ ${amount} ‡∏ø!`);
        }
    }

    window.Telegram.WebApp.onEvent('web_app_data', (event) => {
        const data = event.data;
        if (data && typeof data === 'string') {
            if (data.startsWith('PaymentConfirmed')) {
                const [_, user, amount] = data.split(':');
                if (user === window.Telegram.WebApp.initDataUnsafe.user?.id.toString()) {
                    const paymentId = Object.keys(pendingPayments).find(id => pendingPayments[id].user === currentUser);
                    if (paymentId) checkPendingPayment(paymentId, parseInt(amount));
                }
            } else if (data.startsWith('PaymentRejected')) {
                const [_, user] = data.split(':');
                if (user === window.Telegram.WebApp.initDataUnsafe.user?.id.toString()) {
                    const paymentId = Object.keys(pendingPayments).find(id => pendingPayments[id].user === currentUser);
                    if (paymentId) delete pendingPayments[paymentId];
                    window.Telegram.WebApp.showAlert('–ó–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω—ë–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.');
                }
            }
        }
    });

    function registerUser() {
        const nickname = document.getElementById('regNickname').value.trim();
        if (!nickname) {
            document.getElementById('regError').textContent = '–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫–Ω–µ–π–º!';
            return;
        }
        currentUser = nickname;
        sendToTelegramBot(`üÜï –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:\n–ù–∏–∫–Ω–µ–π–º: ${currentUser}`, null, null);
        document.getElementById('registrationModal').style.display = 'none';
        updateProfile();
        addMailMessage('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Dark Thailand!');
    }

    function showReferralDetails() {
        const modal = document.getElementById('customModal');
        const content = document.getElementById('customContent');
        content.innerHTML = `
            <h2>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</h2>
            <p>–ü—Ä–∏–≥–ª–∞—à–∞–π –¥—Ä—É–∑–µ–π –∏ –ø–æ–ª—É—á–∞–π –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Å—Ç–∞—Ñ—Ñ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –æ–Ω–∏ –ø–æ–ø–æ–ª–Ω—è—Ç –±–∞–ª–∞–Ω—Å –Ω–∞ —Å—É–º–º—É –æ—Ç 1000 ‡∏ø:</p>
            <p>- –ó–∞ 5 –¥—Ä—É–∑–µ–π: 0.5 –≥ –ë–µ–ª–∞—è –ú–æ–ª–Ω–∏—è (VHQ)</p>
            <p>- –ó–∞ 10 –¥—Ä—É–∑–µ–π: 0.5 –≥ –ì—Ä—è–∑–Ω—ã–π –°–Ω–µ–≥ (MQ)</p>
            <p>- –ó–∞ 25 –¥—Ä—É–∑–µ–π: 1 –≥ –¢—Ä–æ–ø–∏–∫ –ë–∏—á (Fishscale)</p>
            <button class="buy-button" onclick="document.getElementById('customModal').style.display='none';">–ó–∞–∫—Ä—ã—Ç—å</button>
        `;
        modal.style.display = 'flex';
        modal.onclick = (e) => {
            if (e.target === modal) modal.style.display = 'none';
        };
    }

    function checkReferralBonus() {
        if (referralCount >= 25 && referralDeposits >= 25000 && !orderHistory.some(o => o.product.includes('–¢—Ä–æ–ø–∏–∫ –ë–∏—á'))) {
            orderHistory.unshift({ date: getRandomDate(), product: "–ë–æ–Ω—É—Å: –¢—Ä–æ–ø–∏–∫ –ë–∏—á (Fishscale) 1 –≥", price: 0 });
            window.Telegram.WebApp.showAlert('–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –ó–∞ 25 –¥—Ä—É–∑–µ–π –∏ –∏—Ö –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –≤—ã –ø–æ–ª—É—á–∏–ª–∏ 1 –≥ –¢—Ä–æ–ø–∏–∫ –ë–∏—á (Fishscale)!');
        } else if (referralCount >= 10 && referralDeposits >= 10000 && !orderHistory.some(o => o.product.includes('–ì—Ä—è–∑–Ω—ã–π –°–Ω–µ–≥'))) {
            orderHistory.unshift({ date: getRandomDate(), product: "–ë–æ–Ω—É—Å: –ì—Ä—è–∑–Ω—ã–π –°–Ω–µ–≥ (MQ) 0.5 –≥", price: 0 });
            window.Telegram.WebApp.showAlert('–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –ó–∞ 10 –¥—Ä—É–∑–µ–π –∏ –∏—Ö –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –≤—ã –ø–æ–ª—É—á–∏–ª–∏ 0.5 –≥ –ì—Ä—è–∑–Ω—ã–π –°–Ω–µ–≥ (MQ)!');
        } else if (referralCount >= 5 && referralDeposits >= 5000 && !orderHistory.some(o => o.product.includes('–ë–µ–ª–∞—è –ú–æ–ª–Ω–∏—è'))) {
            orderHistory.unshift({ date: getRandomDate(), product: "–ë–æ–Ω—É—Å: –ë–µ–ª–∞—è –ú–æ–ª–Ω–∏—è (VHQ) 0.5 –≥", price: 0 });
            window.Telegram.WebApp.showAlert('–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –ó–∞ 5 –¥—Ä—É–∑–µ–π –∏ –∏—Ö –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –≤—ã –ø–æ–ª—É—á–∏–ª–∏ 0.5 –≥ –ë–µ–ª–∞—è –ú–æ–ª–Ω–∏—è (VHQ)!');
        }
    }

    function updateMail() {
        const mailList = document.getElementById('mailList');
        mailList.innerHTML = mailMessages.length > 0 ? mailMessages.map(msg => `<p>${msg.date}: ${msg.text}</p>`).join('') : '–ü–æ–∫–∞ –Ω–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π.';
    }

    function addMailMessage(text) {
        mailMessages.unshift({ date: getRandomDate(), text });
        updateMail();
    }

    function filterByCity() {
        selectedCity = document.getElementById('citySelect').value;
        updateDistrictFilter();
        filterProducts(document.querySelector('.tab.active')?.getAttribute('data-tab') || 'hash');
    }

    function updateDistrictFilter() {
        const districtSelect = document.getElementById('districtSelect');
        districtSelect.innerHTML = '<option value="all">–í—Å–µ —Ä–∞–π–æ–Ω—ã</option>';
        if (selectedCity !== 'all') {
            for (const district in cities[selectedCity]) {
                const option = document.createElement('option');
                option.value = district;
                option.text = district;
                districtSelect.appendChild(option);
            }
        }
        selectedDistrict = 'all';
    }

    function filterByDistrict() {
        selectedDistrict = document.getElementById('districtSelect').value;
        filterProducts(document.querySelector('.tab.active')?.getAttribute('data-tab') || 'hash');
    }

    function showTab(category) {
        document.querySelectorAll('.tab-content').forEach(content => {
            content.style.display = 'none';
        });
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        const tab = document.querySelector(`.tab[data-tab="${category}"]`);
        tab.classList.add('active');
        document.getElementById(category).style.display = 'block';
        filterProducts(category);
    }

    function filterProducts(category) {
        if (!products) return; // –ó–∞—â–∏—Ç–∞ –æ—Ç –≤—ã–∑–æ–≤–∞ –¥–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        const productsInCategory = document.querySelectorAll(`#${category} .product-card`);
        productsInCategory.forEach(card => {
            const productId = card.getAttribute('data-product').split('-')[1];
            const product = products[category][productId];
            const hasMatch = product.positions.some(pos => 
                (selectedCity === 'all' || pos.city === selectedCity) &&
                (selectedDistrict === 'all' || pos.district === selectedDistrict)
            );
            card.style.display = hasMatch ? 'block' : 'none';
        });
    }

    function showProductModal(category, id) {
        const product = products[category][id];
        const modal = document.getElementById('productModal');
        const content = document.getElementById('productContent');
        let html = `<h2>${product.name}</h2>`;
        html += '<h3>–ü–æ–∑–∏—Ü–∏–∏:</h3>';
        product.positions.forEach(pos => {
            if ((selectedCity === 'all' || pos.city === selectedCity) && 
                (selectedDistrict === 'all' || pos.district === selectedDistrict)) {
                const preorderPrice = Math.round(pos.price * 1.3);
                const preorderCryptoPrice = (pos.cryptoPrice * 1.3).toFixed(5);
                html += `<div class="position">
                    <p>–í–µ—Å: ${pos.weight} –≥</p>
                    <p class="price">${pos.price} ‡∏ø (~${pos.cryptoPrice} BTC)</p>
                    <p>–ì–æ—Ä–æ–¥: ${pos.city === 'phuket' ? '–ü—Ö—É–∫–µ—Ç' : pos.city === 'pattaya' ? '–ü–∞—Ç—Ç–∞–π—è' : pos.city === 'bangkok' ? '–ë–∞–Ω–≥–∫–æ–∫' : '–æ. –°–∞–º—É–∏'}, ${pos.district}</p>
                    <p>–ù–∞–ª–∏—á–∏–µ: ${pos.inStock ? '–í –Ω–∞–ª–∏—á–∏–∏' : '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏'}</p>
                    ${pos.inStock ? `<button class="buy-button" onclick="buyProduct('${category}', ${id}, ${pos.id})">–ö—É–ø–∏—Ç—å</button>` : ''}
                    <button class="preorder-button" onclick="preorderProduct('${category}', ${id}, ${pos.id}, ${preorderPrice}, '${preorderCryptoPrice}')">–ü—Ä–µ–¥–∑–∞–∫–∞–∑ (+30%)</button>
                </div>`;
            }
        });
        html += '<h3>–û—Ç–∑—ã–≤—ã:</h3>';
        product.reviews.forEach(review => {
            html += `<div class="review">${review.text}</div>`;
            if (review.mod) html += `<div class="moderator-response">${review.mod}</div>`;
        });
        content.innerHTML = html;
        modal.style.display = 'flex';
        modal.onclick = (e) => {
            if (e.target === modal) modal.style.display = 'none';
        };
    }

    function buyProduct(category, productId, positionId) {
        const product = products[category][productId];
        const position = product.positions.find(pos => pos.id === positionId);
        if (!position.inStock) {
            window.Telegram.WebApp.showAlert('–¢–æ–≤–∞—Ä–∞ –Ω–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏!');
            return;
        }
        if (balance < position.price) {
            showCustomConfirm('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ! –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ?', 
                () => {
                    toggleProfile();
                    document.getElementById('productModal').style.display = 'none';
                }, 
                () => {}
            );
            return;
        }
        balance -= position.price;
        orderCount++;
        orderHistory.unshift({ date: getRandomDate(), product: `${product.name} (${position.weight} –≥)`, price: position.price });
        const modal = document.getElementById('paymentModal');
        const content = document.getElementById('paymentContent');
        const coords = getRandomCoordinates(position.city, position.district);
        const cityInfo = cities[position.city][position.district];
        content.innerHTML = `
            <h2>–û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞!</h2>
            <p>–¢–æ–≤–∞—Ä: ${product.name}</p>
            <p>–í–µ—Å: ${position.weight} –≥</p>
            <p>–°—É–º–º–∞: ${position.price} ‡∏ø (~${position.cryptoPrice} BTC)</p>
            <p>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ${coords.lat}, ${coords.lon}</p>
            <p>–û–ø–∏—Å–∞–Ω–∏–µ: ${cityInfo.desc}</p>
            <button class="buy-button" onclick="document.getElementById('paymentModal').style.display='none';updateProfile();">–ó–∞–∫—Ä—ã—Ç—å</button>
        `;
        modal.style.display = 'flex';
        document.getElementById('productModal').style.display = 'none';
        modal.onclick = (e) => {
            if (e.target === modal) {
                modal.style.display = 'none';
                updateProfile();
            }
        };
    }

    function preorderProduct(category, productId, positionId, preorderPrice, preorderCryptoPrice) {
        const product = products[category][productId];
        const position = product.positions.find(pos => pos.id === positionId);
        const modal = document.getElementById('preorderModal');
        const content = document.getElementById('preorderContent');
        content.innerHTML = `
            <h2>–ü—Ä–µ–¥–∑–∞–∫–∞–∑</h2>
            <p>–¢–æ–≤–∞—Ä: ${product.name}</p>
            <p>–í–µ—Å: ${position.weight} –≥</p>
            <p>–°—É–º–º–∞: ${preorderPrice} ‡∏ø (~${preorderCryptoPrice} BTC)</p>
            <p>–ö–ª–∞–¥ –±—É–¥–µ—Ç —Å–¥–µ–ª–∞–Ω –≤ –∂–µ–ª–∞–µ–º–æ–π –ª–æ–∫–∞—Ü–∏–∏, –±–ª–∏–∑–∫–æ –∫ –º–µ—Å—Ç—É, –∫–æ—Ç–æ—Ä–æ–µ –≤—ã —É–∫–∞–∂–µ—Ç–µ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã.</p>
            <button class="buy-button" onclick="confirmPreorder('${category}', ${productId}, ${positionId}, ${preorderPrice}, '${preorderCryptoPrice}')">–°–¥–µ–ª–∞—Ç—å –ø—Ä–µ–¥–∑–∞–∫–∞–∑</button>
        `;
        modal.style.display = 'flex';
        modal.onclick = (e) => {
            if (e.target === modal) modal.style.display = 'none';
        };
    }

    function confirmPreorder(category, productId, positionId, preorderPrice, preorderCryptoPrice) {
        const product = products[category][productId];
        const position = product.positions.find(pos => pos.id === positionId);
        if (balance < preorderPrice) {
            showCustomConfirm('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ! –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ?', 
                () => {
                    toggleProfile();
                    document.getElementById('preorderModal').style.display = 'none';
                    document.getElementById('customModal').style.display = 'none';
                }, 
                () => {
                    document.getElementById('preorderModal').style.display = 'none';
                }
            );
            return;
        }
        balance -= preorderPrice;
        orderCount++;
        orderHistory.unshift({ date: getRandomDate(), product: `${product.name} (${position.weight} –≥, –ø—Ä–µ–¥–∑–∞–∫–∞–∑)`, price: preorderPrice });
        showCustomPrompt('–£–∫–∞–∂–∏—Ç–µ –∂–µ–ª–∞–µ–º—É—é –ª–æ–∫–∞—Ü–∏—é –¥–ª—è –∫–ª–∞–¥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ü—Ö—É–∫–µ—Ç, –ü–∞—Ç–æ–Ω–≥, —É –±–∞—Ä–∞ X):', (location) => {
            const modal = document.getElementById('paymentModal');
            const content = document.getElementById('paymentContent');
            const coords = getRandomCoordinates(position.city, position.district);
            if (!location) {
                content.innerHTML = `
                    <h2>–ü—Ä–µ–¥–∑–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω!</h2>
                    <p>–¢–æ–≤–∞—Ä: ${product.name}</p>
                    <p>–í–µ—Å: ${position.weight} –≥</p>
                    <p>–°—É–º–º–∞: ${preorderPrice} ‡∏ø (~${preorderCryptoPrice} BTC)</p>
                    <p>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ${coords.lat}, ${coords.lon}</p>
                    <p>–ö–ª–∞–¥ –±—É–¥–µ—Ç —Å–¥–µ–ª–∞–Ω –≤ —Å–ª—É—á–∞–π–Ω–æ–π –ª–æ–∫–∞—Ü–∏–∏ –≤ —Ä–∞–π–æ–Ω–µ ${position.city === 'phuket' ? '–ü—Ö—É–∫–µ—Ç' : position.city === 'pattaya' ? '–ü–∞—Ç—Ç–∞–π—è' : position.city === 'bangkok' ? '–ë–∞–Ω–≥–∫–æ–∫' : '–æ. –°–∞–º—É–∏'}, ${position.district}.</p>
                    <p>–û–∂–∏–¥–∞–π—Ç–µ –≤ —Ç–µ—á–µ–Ω–∏–µ 2 —á–∞—Å–æ–≤!</p>
                    <button class="buy-button" onclick="document.getElementById('paymentModal').style.display='none';updateProfile();">–ó–∞–∫—Ä—ã—Ç—å</button>
                `;
            } else {
                content.innerHTML = `
                    <h2>–ü—Ä–µ–¥–∑–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω!</h2>
                    <p>–¢–æ–≤–∞—Ä: ${product.name}</p>
                    <p>–í–µ—Å: ${position.weight} –≥</p>
                    <p>–°—É–º–º–∞: ${preorderPrice} ‡∏ø (~${preorderCryptoPrice} BTC)</p>
                    <p>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ${coords.lat}, ${coords.lon}</p>
                    <p>–ö–ª–∞–¥ –±—É–¥–µ—Ç —Å–¥–µ–ª–∞–Ω —Ä—è–¥–æ–º —Å: ${location}</p>
                    <p>–û–∂–∏–¥–∞–π—Ç–µ –≤ —Ç–µ—á–µ–Ω–∏–µ 2 —á–∞—Å–æ–≤!</p>
                    <button class="buy-button" onclick="document.getElementById('paymentModal').style.display='none';updateProfile();">–ó–∞–∫—Ä—ã—Ç—å</button>
                `;
            }
            modal.style.display = 'flex';
            document.getElementById('preorderModal').style.display = 'none';
            modal.onclick = (e) => {
                if (e.target === modal) {
                    modal.style.display = 'none';
                    updateProfile();
                }
            };
        });
    }

    function showDepositModal(crypto) {
        const modal = document.getElementById('depositModal');
        const content = document.getElementById('depositContent');
        content.innerHTML = `
            <h2>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ ${crypto}</h2>
            <input type="number" id="depositAmount" min="1000" placeholder="–°—É–º–º–∞ (–º–∏–Ω. 1000 ‡∏ø)" class="custom-input" oninput="updateCryptoAmount('${crypto}')">
            <p id="cryptoAmount">~0 BTC</p>
            <button class="buy-button" onclick="generateAddress('${crypto}')">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å</button>
            <div id="addressBox"></div>
        `;
        modal.style.display = 'flex';
        modal.onclick = (e) => {
            if (e.target === modal) modal.style.display = 'none';
        };
    }

    function updateCryptoAmount(crypto) {
        const amount = document.getElementById('depositAmount').value;
        const cryptoAmount = amount ? (amount / BTC_RATE).toFixed(5) : 0;
        document.getElementById('cryptoAmount').textContent = `~${cryptoAmount} ${crypto === 'BTC' ? 'BTC' : 'BTC'}`;
    }

    function generateAddress(crypto) {
        const amount = document.getElementById('depositAmount').value;
        if (!amount || amount < 1000) {
            window.Telegram.WebApp.showAlert('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –Ω–µ –º–µ–Ω–µ–µ 1000 ‡∏ø!');
            return;
        }
        const addressBox = document.getElementById('addressBox');
        const address = testAddresses[crypto];
        addressBox.innerHTML = `
            <p>–ê–¥—Ä–µ—Å: ${address}</p>
            <p>–°—É–º–º–∞ –∫ –æ–ø–ª–∞—Ç–µ: ${amount} ‡∏ø (~${(amount / BTC_RATE).toFixed(5)} ${crypto})</p>
            <p>–î–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω 30 –º–∏–Ω—É—Ç!</p>
            <button class="buy-button" onclick="confirmPayment('${crypto}', '${address}', ${amount})">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–ø–ª–∞—Ç—É</button>
        `;
        setTimeout(() => {
            addressBox.innerHTML = '<p>–ê–¥—Ä–µ—Å –∏—Å—Ç—ë–∫!</p>';
        }, 30 * 60 * 1000);
    }

    function applyForJob(job) {
        showCustomTextareaPrompt(`–û—Å—Ç–∞–≤—å—Ç–µ –∑–∞—è–≤–∫—É –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏—é "${job}". –£–∫–∞–∂–∏—Ç–µ –∫—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ:`, (resume) => {
            if (resume) {
                sendToTelegramBot(`üìã –ó–∞—è–≤–∫–∞ –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏—é "${job}" –æ—Ç ${currentUser}:\n–†–µ–∑—é–º–µ: ${resume}`, null, null);
                window.Telegram.WebApp.showAlert(`–ó–∞—è–≤–∫–∞ –Ω–∞ "${job}" –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –û–∂–∏–¥–∞–π—Ç–µ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –ø–æ—á—Ç–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.`);
            }
        });
    }

    function showCustomConfirm(message, onConfirm, onCancel) {
        const modal = document.getElementById('customModal');
        const content = document.getElementById('customContent');
        content.innerHTML = `
            <h2>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h2>
            <p>${message}</p>
            <button class="buy-button" onclick="confirmAction()">–î–∞</button>
            <button class="buy-button" onclick="cancelAction()">–ù–µ—Ç</button>
        `;
        modal.style.display = 'flex';
        window.confirmAction = () => {
            onConfirm();
            modal.style.display = 'none';
        };
        window.cancelAction = () => {
            onCancel();
            modal.style.display = 'none';
        };
        modal.onclick = (e) => {
            if (e.target === modal) modal.style.display = 'none';
        };
    }

    function showCustomPrompt(message, callback) {
        const modal = document.getElementById('customModal');
        const content = document.getElementById('customContent');
        content.innerHTML = `
            <h2>–í–≤–æ–¥</h2>
            <p>${message}</p>
            <input type="text" id="customInput" class="custom-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–¥–µ—Å—å">
            <button class="buy-button" onclick="submitPrompt()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
        `;
        modal.style.display = 'flex';
        window.submitPrompt = () => {
            const value = document.getElementById('customInput').value.trim();
            callback(value);
            modal.style.display = 'none';
        };
        modal.onclick = (e) => {
            if (e.target === modal) modal.style.display = 'none';
        };
    }

    function showCustomTextareaPrompt(message, callback) {
        const modal = document.getElementById('customModal');
        const content = document.getElementById('customContent');
        content.innerHTML = `
            <h2>–ó–∞—è–≤–∫–∞</h2>
            <p>${message}</p>
            <textarea id="customTextarea" class="custom-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–¥–µ—Å—å"></textarea>
            <button class="buy-button" onclick="submitTextarea()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        `;
        modal.style.display = 'flex';
        window.submitTextarea = () => {
            const value = document.getElementById('customTextarea').value.trim();
            callback(value);
            modal.style.display = 'none';
        };
        modal.onclick = (e) => {
            if (e.target === modal) modal.style.display = 'none';
        };
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    document.addEventListener('DOMContentLoaded', async () => {
        await fetchBTCRate(); // –ü–æ–ª—É—á–∞–µ–º –∫—É—Ä—Å BTC
        initializeData();     // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
        if (!currentUser) {
            document.getElementById('registrationModal').style.display = 'flex';
        }
        document.getElementById('referralCount').addEventListener('click', () => {
            referralCount++;
            updateProfile();
        });
    });
</script>
</body>
</html>
