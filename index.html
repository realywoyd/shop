<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="sandbox allow-same-origin allow-modals allow-scripts">
    <title>Dark Thailand - Надёжный шоп</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1a1a1a 0%, #2b0000 100%);
            color: #ff4444;
            overflow-x: hidden;
        }
        .container { max-width: 600px; margin: 0 auto; padding: 15px; position: relative; }
        .header { text-align: center; padding: 15px 0; background-color: #2b2b2b; color: #ff4444; margin-bottom: 20px; border-radius: 5px; border: 2px solid #ff4444; box-shadow: 0 0 10px rgba(255, 68, 68, 0.5); }
        .logo { font-size: 48px; animation: textPulse 2s infinite; display: inline-block; }
        @keyframes textPulse { 0% { transform: scale(1); text-shadow: 0 0 5px #ff4444; } 50% { transform: scale(1.05); text-shadow: 0 0 20px #ff4444, 0 0 30px #ff6666; } 100% { transform: scale(1); text-shadow: 0 0 5px #ff4444; } }
        .header-text { font-size: 16px; margin-top: 5px; animation: textFlicker 3s infinite; }
        @keyframes textFlicker { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .nav { display: flex; justify-content: space-between; margin-bottom: 20px; }
        .nav-button { background-color: #ff4444; color: #000; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 16px; animation: neonPulse 1.5s infinite; }
        .profile-button { background-color: #ff4444; color: #000; border: none; padding: 0; border-radius: 5px; cursor: pointer; font-size: 26px; width: 60px; height: 40px; line-height: 40px; text-align: center; animation: neonPulse 1.5s infinite; }
        @keyframes neonPulse { 0% { box-shadow: 0 0 5px #ff4444; } 50% { box-shadow: 0 0 20px #ff4444; } 100% { box-shadow: 0 0 5px #ff4444; } }
        .catalog-menu, .profile-menu, .vacancy-menu, .mail-menu { display: none; background-color: #333; border-radius: 5px; padding: 15px; box-shadow: 0 0 15px rgba(255, 68, 68, 0.3); }
        .city-filter { margin-bottom: 15px; }
        .city-filter select, .district-filter select { width: 100%; padding: 10px; background-color: #2b2b2b; color: #ff4444; border: 1px solid #ff4444; border-radius: 5px; font-size: 16px; margin-bottom: 10px; }
        .tabs { display: flex; flex-wrap: wrap; margin-bottom: 15px; }
        .tab { flex: 1; text-align: center; padding: 10px; background-color: #2b2b2b; cursor: pointer; margin: 5px; border-radius: 5px; transition: all 0.3s; }
        .tab:hover { background-color: #ff6666; }
        .tab.active { background-color: #ff4444; color: #000; box-shadow: 0 0 10px #ff4444; }
        .tab-content { display: none; }
        .product-card { background-color: #333; border-radius: 5px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(255, 68, 68, 0.3); transition: transform 0.2s; }
        .product-card:hover { transform: scale(1.02); }
        .product-card h3 { margin-top: 0; color: #ff6666; cursor: pointer; }
        .product-card p { margin: 5px 0; }
        .price { font-weight: bold; color: #ff9999; }
        .crypto-price { font-size: 12px; color: #ff6666; }
        .buy-button, .preorder-button { background-color: #ff4444; color: #000; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin: 5px 0; width: 100%; transition: all 0.3s; }
        .preorder-button { background-color: #ff6666; }
        .buy-button:hover, .preorder-button:hover { background-color: #ff8888; }
        .payment-modal, .product-modal, .deposit-modal, .preorder-modal, .registration-modal, .custom-modal, .confirm-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); justify-content: center; align-items: center; }
        .payment-content, .product-content, .deposit-content, .preorder-content, .registration-content, .custom-content, .confirm-content { background: #333; padding: 20px; border-radius: 5px; text-align: center; color: #ff4444; max-width: 500px; max-height: 80vh; overflow-y: auto; border: 2px solid #ff4444; box-shadow: 0 0 15px rgba(255, 68, 68, 0.5); }
        .review { background-color: #2b2b2b; border-left: 4px solid #ff6666; padding: 10px; margin: 10px 0; font-size: 12px; color: #ff9999; text-align: left; display: flex; justify-content: space-between; }
        .review-text { flex-grow: 1; }
        .review-date { flex-shrink: 0; margin-left: 10px; color: #ff6666; }
        .moderator-response { background-color: #2b2b2b; border-left: 4px solid #ff4444; padding: 10px; margin: 5px 0 10px 20px; font-size: 12px; color: #ff6666; text-align: left; }
        .position { margin: 10px 0; text-align: left; }
        .promo-banner { background-color: #ff4444; color: #000; padding: 10px; text-align: center; margin-bottom: 20px; border-radius: 5px; font-weight: bold; }
        .vacancy { margin-bottom: 15px; }
        .vacancy h3 { color: #ff6666; }
        input[type="text"], textarea, input[type="number"], select { width: 100%; padding: 10px; margin: 10px 0; background-color: #2b2b2b; color: #ff4444; border: 1px solid #ff4444; border-radius: 5px; }
        textarea { height: 100px; resize: none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="promo-banner" id="promoBanner"></div>

        <div class="header">
            <div class="logo">Dark Thailand</div>
            <div class="header-text" id="headerText"></div>
        </div>
        
        <div class="nav">
            <button class="nav-button" id="catalogButton" onclick="toggleCatalog()"></button>
            <button class="nav-button" id="vacanciesButton" onclick="toggleVacancies()"></button>
            <button class="nav-button" id="mailButton" onclick="toggleMail()"></button>
            <button class="profile-button" onclick="toggleProfile()">☠️</button>
        </div>
        
        <div class="catalog-menu" id="catalogMenu">
            <div class="city-filter">
                <select id="citySelect" onchange="filterByCity()">
                    <option value="all" id="allCitiesOption"></option>
                    <option value="phuket" id="phuketOption"></option>
                    <option value="pattaya" id="pattayaOption"></option>
                    <option value="bangkok" id="bangkokOption"></option>
                    <option value="samui" id="samuiOption"></option>
                </select>
                <select id="districtSelect" onchange="filterByDistrict()">
                    <option value="all" id="allDistrictsOption"></option>
                </select>
            </div>
            <div class="tabs">
                <div class="tab" data-tab="weed" id="weedTab">Марихуана</div>
                <div class="tab" data-tab="hash" id="hashTab">Гашиш</div>
                <div class="tab" data-tab="coke" id="cokeTab">Кокаин</div>
                <div class="tab" data-tab="amph" id="amphTab">Амфетамин</div>
                <div class="tab" data-tab="meth" id="methTab">Метамфетамин</div>
                <div class="tab" data-tab="meph" id="mephTab">Мефедрон</div>
                <div class="tab" data-tab="alpha" id="alphaTab">Альфа-PVP</div>
                <div class="tab" data-tab="lsd" id="lsdTab">ЛСД</div>
                <div class="tab" data-tab="mdma" id="mdmaTab">МДМА</div>
                <div class="tab" data-tab="heroin" id="heroinTab">Героин</div>
            </div>

            <div id="weed" class="tab-content">
                <div class="product-card" data-product="weed-1">
                    <h3 onclick="showProductModal('weed', 1)">Jamaican Haze (VHQ)</h3>
                    <p id="weedDesc"></p>
                </div>
            </div>

            <div id="hash" class="tab-content">
                <div class="product-card" data-product="hash-1">
                    <h3 onclick="showProductModal('hash', 1)">Afghan Black Gold (VHQ)</h3>
                    <p>Премиум афганский гашиш, бархатный эффект</p>
                </div>
                <div class="product-card" data-product="hash-2">
                    <h3 onclick="showProductModal('hash', 2)">Moroccan Spice (HQ)</h3>
                    <p>Марокканский гашиш с пряным ароматом</p>
                </div>
                <div class="product-card" data-product="hash-3">
                    <h3 onclick="showProductModal('hash', 3)">Nepal Temple (MQ)</h3>
                    <p>Непальский гашиш, сбалансированный приход</p>
                </div>
                <div class="product-card" data-product="hash-4">
                    <h3 onclick="showProductModal('hash', 4)">Local Dust (LQ)</h3>
                    <p>Местный бюджетный гашиш</p>
                </div>
                <div class="product-card" data-product="hash-5">
                    <h3 onclick="showProductModal('hash', 5)">Himalayan Storm (VHQ)</h3>
                    <p>Гималайский шторм, мощный и чистый</p>
                </div>
            </div>

            <div id="coke" class="tab-content">
                <div class="product-card" data-product="coke-1">
                    <h3 onclick="showProductModal('coke', 1)">Bolivian Fishscale (VHQ)</h3>
                    <p>Боливийский кокаин, топовый 95%+</p>
                </div>
                <div class="product-card" data-product="coke-2">
                    <h3 onclick="showProductModal('coke', 2)">Colombian Snow (HQ)</h3>
                    <p>Колумбийский снег, чистый и мощный</p>
                </div>
                <div class="product-card" data-product="coke-3">
                    <h3 onclick="showProductModal('coke', 3)">Peruvian Dust (MQ)</h3>
                    <p>Перуанская пыль, средний уровень</p>
                </div>
                <div class="product-card" data-product="coke-4">
                    <h3 onclick="showProductModal('coke', 4)">Street Mix (LQ)</h3>
                    <p>Уличная смесь, бюджетный вариант</p>
                </div>
                <div class="product-card" data-product="coke-5">
                    <h3 onclick="showProductModal('coke', 5)">Cartel Gold (VHQ)</h3>
                    <p>Золото картеля, элитный стандарт</p>
                </div>
            </div>

            <div id="amph" class="tab-content">
                <div class="product-card" data-product="amph-1">
                    <h3 onclick="showProductModal('amph', 1)">Crystal Surge (VHQ)</h3>
                    <p>Кристальный амфетамин, чистая энергия</p>
                </div>
                <div class="product-card" data-product="amph-2">
                    <h3 onclick="showProductModal('amph', 2)">Red Rush (HQ)</h3>
                    <p>Красный заряд, стабильный драйв</p>
                </div>
                <div class="product-card" data-product="amph-3">
                    <h3 onclick="showProductModal('amph', 3)">Yellow Spark (MQ)</h3>
                    <p>Жёлтая искра, средний подъём</p>
                </div>
                <div class="product-card" data-product="amph-4">
                    <h3 onclick="showProductModal('amph', 4)">Grey Haze (LQ)</h3>
                    <p>Серая дымка, базовый вариант</p>
                </div>
                <div class="product-card" data-product="amph-5">
                    <h3 onclick="showProductModal('amph', 5)">Blue Blitz (VHQ)</h3>
                    <p>Синий удар, элитный амф</p>
                </div>
            </div>

            <div id="meth" class="tab-content">
                <div class="product-card" data-product="meth-1">
                    <h3 onclick="showProductModal('meth', 1)">Mountain Ice (VHQ)</h3>
                    <p>Горный лёд, кристальная чистота</p>
                </div>
                <div class="product-card" data-product="meth-2">
                    <h3 onclick="showProductModal('meth', 2)">Blue Flame (HQ)</h3>
                    <p>Синее пламя, долгий эффект</p>
                </div>
                <div class="product-card" data-product="meth-3">
                    <h3 onclick="showProductModal('meth', 3)">White Shard (MQ)</h3>
                    <p>Белый осколок, средний уровень</p>
                </div>
                <div class="product-card" data-product="meth-4">
                    <h3 onclick="showProductModal('meth', 4)">Dirty Crystal (LQ)</h3>
                    <p>Грязный кристалл, эконом-класс</p>
                </div>
                <div class="product-card" data-product="meth-5">
                    <h3 onclick="showProductModal('meth', 5)">Golden Shard (VHQ)</h3>
                    <p>Золотой осколок, топовый мет</p>
                </div>
            </div>

            <div id="meph" class="tab-content">
                <div class="product-card" data-product="meph-1">
                    <h3 onclick="showProductModal('meph', 1)">Pink Bliss (VHQ)</h3>
                    <p>Розовое блаженство, чистейший кайф</p>
                </div>
                <div class="product-card" data-product="meph-2">
                    <h3 onclick="showProductModal('meph', 2)">White Surge (HQ)</h3>
                    <p>Белый всплеск, стабильный эффект</p>
                </div>
                <div class="product-card" data-product="meph-3">
                    <h3 onclick="showProductModal('meph', 3)">Grey Mist (MQ)</h3>
                    <p>Серая дымка, средний уровень</p>
                </div>
                <div class="product-card" data-product="meph-4">
                    <h3 onclick="showProductModal('meph', 4)">Dusty High (LQ)</h3>
                    <p>Пыльный кайф, бюджетный меф</p>
                </div>
                <div class="product-card" data-product="meph-5">
                    <h3 onclick="showProductModal('meph', 5)">Red Pulse (VHQ)</h3>
                    <p>Красный пульс, элитный рывок</p>
                </div>
            </div>

            <div id="alpha" class="tab-content">
                <div class="product-card" data-product="alpha-1">
                    <h3 onclick="showProductModal('alpha', 1)">Flakka Fire (VHQ)</h3>
                    <p>Огненная флакка, чистый Альфа-PVP</p>
                </div>
                <div class="product-card" data-product="alpha-2">
                    <h3 onclick="showProductModal('alpha', 2)">Purple Haze (HQ)</h3>
                    <p>Пурпурная дымка, мощный заряд</p>
                </div>
                <div class="product-card" data-product="alpha-3">
                    <h3 onclick="showProductModal('alpha', 3)">Green Dust (MQ)</h3>
                    <p>Зелёная пыль, средний эффект</p>
                </div>
                <div class="product-card" data-product="alpha-4">
                    <h3 onclick="showProductModal('alpha', 4)">Street Gravel (LQ)</h3>
                    <p>Уличный гравий, бюджетный Альфа</p>
                </div>
                <div class="product-card" data-product="alpha-5">
                    <h3 onclick="showProductModal('alpha', 5)">Crystal Fury (VHQ)</h3>
                    <p>Кристальная ярость, топовый PVP</p>
                </div>
            </div>

            <div id="lsd" class="tab-content">
                <div class="product-card" data-product="lsd-1">
                    <h3 onclick="showProductModal('lsd', 1)">Cosmic Tabs (VHQ)</h3>
                    <p>Космические таблы, чистый трип</p>
                </div>
                <div class="product-card" data-product="lsd-2">
                    <h3 onclick="showProductModal('lsd', 2)">Neon Drops (HQ)</h3>
                    <p>Неоновые капли, яркий опыт</p>
                </div>
                <div class="product-card" data-product="lsd-3">
                    <h3 onclick="showProductModal('lsd', 3)">Acid Rain (MQ)</h3>
                    <p>Кислотный дождь, средний трип</p>
                </div>
                <div class="product-card" data-product="lsd-4">
                    <h3 onclick="showProductModal('lsd', 4)">Street Blotters (LQ)</h3>
                    <p>Уличные блоттеры, базовый ЛСД</p>
                </div>
                <div class="product-card" data-product="lsd-5">
                    <h3 onclick="showProductModal('lsd', 5)">Galactic Hits (VHQ)</h3>
                    <p>Галактические хиты, элитный кислый</p>
                </div>
            </div>

            <div id="mdma" class="tab-content">
                <div class="product-card" data-product="mdma-1">
                    <h3 onclick="showProductModal('mdma', 1)">Crystal Love (VHQ)</h3>
                    <p>Кристальная любовь, чистый МДМА</p>
                </div>
                <div class="product-card" data-product="mdma-2">
                    <h3 onclick="showProductModal('mdma', 2)">Pink Rocks (HQ)</h3>
                    <p>Розовые камни, стабильный кайф</p>
                </div>
                <div class="product-card" data-product="mdma-3">
                    <h3 onclick="showProductModal('mdma', 3)">Ecstasy Blue (VHQ Tabs)</h3>
                    <p>Синий экстази, топовые пилсы</p>
                </div>
                <div class="product-card" data-product="mdma-4">
                    <h3 onclick="showProductModal('mdma', 4)">Molly Dust (MQ)</h3>
                    <p>Молли пыль, средний МДМА</p>
                </div>
                <div class="product-card" data-product="mdma-5">
                    <h3 onclick="showProductModal('mdma', 5)">Street Pills (LQ Tabs)</h3>
                    <p>Уличные пилсы, бюджетный экстази</p>
                </div>
            </div>

            <div id="heroin" class="tab-content">
                <div class="product-card" data-product="heroin-1">
                    <h3 onclick="showProductModal('heroin', 1)">Afghan Silk (VHQ)</h3>
                    <p>Афганский шёлк, глубокий приход</p>
                </div>
                <div class="product-card" data-product="heroin-2">
                    <h3 onclick="showProductModal('heroin', 2)">White Lotus (HQ)</h3>
                    <p>Белый лотос, чистый эффект</p>
                </div>
                <div class="product-card" data-product="heroin-3">
                    <h3 onclick="showProductModal('heroin', 3)">Brown Sugar (MQ)</h3>
                    <p>Коричневый сахар, средний героин</p>
                </div>
                <div class="product-card" data-product="heroin-4">
                    <h3 onclick="showProductModal('heroin', 4)">Dirty Tar (LQ)</h3>
                    <p>Грязный тарт, бюджетный вариант</p>
                </div>
                <div class="product-card" data-product="heroin-5">
                    <h3 onclick="showProductModal('heroin', 5)">Black Pearl (VHQ)</h3>
                    <p>Чёрная жемчужина, элитный героин</p>
                </div>
            </div>
        </div>

        <div class="profile-menu" id="profileMenu">
            <div class="profile-info">
                <h3>☠️</h3>
                <p id="profileNameLabel"></p>
                <p>Баланс: <span id="balance">0 ฿</span></p>
                <p id="ordersLabel"></p>
                <p id="referralsLabel"></p>
            </div>
            <div class="deposit-options">
                <h3 id="depositTitle"></h3>
                <button class="nav-button" onclick="showDepositModal('BTC')">Bitcoin (BTC)</button>
                <button class="nav-button" onclick="showDepositModal('ETH')">Ethereum (ETH)</button>
                <button class="nav-button" onclick="showDepositModal('USDT')">Tether (USDT)</button>
                <button class="nav-button" onclick="showDepositModal('SOL')">Solana (SOL)</button>
                <button class="nav-button" onclick="showDepositModal('TON')">Toncoin (TON)</button>
            </div>
            <div class="order-history">
                <h3 id="orderHistoryTitle"></h3>
                <div id="orderList"></div>
            </div>
            <div class="promo-info">
                <p id="promoInfo"></p>
                <button class="nav-button" onclick="showPromoDetails()">Подробнее</button>
            </div>
        </div>

        <div class="vacancy-menu" id="vacancyMenu">
    <h2 id="vacanciesTitle">Вакансии</h2>
    <div class="vacancy">
        <h3 id="courierTitle">Кладмен</h3>
        <p id="courierDuties">Обязанности: Делать клады.</p>
        <p id="courierPay">Оплата: от 100000 батт/месяц</p>
        <button class="buy-button" onclick="applyForJob('Курьер')" id="applyButton1">Откликнуться</button>
    </div>
    <div class="vacancy">
        <h3 id="warehousemanTitle">Складмен</h3>
        <p id="warehousemanDuties">Обязанности: Приём больших партий, делать мастер-клады для кладменов.</p>
        <p id="warehousemanPay">Оплата: от 200000 батт/месяц</p>
        <button class="buy-button" onclick="applyForJob('Складмен')" id="applyButton2">Откликнуться</button>
    </div>
    <div class="vacancy">
        <h3 id="transporterTitle">Перевозчик</h3>
        <p id="transporterDuties">Обязанности: перевозка товара по всему Тайланду.</p>
        <p id="transporterPay">Оплата: от 350000 батт/месяц</p>
        <button class="buy-button" onclick="applyForJob('Перевозчик')" id="applyButton3">Откликнуться</button>
    </div>
    <div class="vacancy">
        <h3 id="smmTitle">SMMщик</h3>
        <p id="smmDuties">Обязанности: Рекламировать магазин</p>
        <p id="smmPay">Оплата: от 70000 батт/неделя</p>
        <button class="buy-button" onclick="applyForJob('SMMщик')" id="applyButton4">Откликнуться</button>
    </div>
</div>

        <div class="mail-menu" id="mailMenu">
            <h2 id="mailTitle"></h2>
            <div id="mailList"></div>
        </div>

        <div class="product-modal" id="productModal">
            <div class="product-content" id="productContent"></div>
        </div>

        <div class="payment-modal" id="paymentModal">
            <div class="payment-content" id="paymentContent"></div>
        </div>

        <div class="deposit-modal" id="depositModal">
            <div class="deposit-content" id="depositContent"></div>
        </div>

        <div class="preorder-modal" id="preorderModal">
            <div class="preorder-content" id="preorderContent"></div>
        </div>

        <div class="registration-modal" id="registrationModal">
            <div class="registration-content" id="registrationContent">
                <h2>Регистрация</h2>
                <p>Введите желаемый никнейм:</p>
                <input type="text" id="regNickname" placeholder="Ваш никнейм">
                <p>Выберите язык:</p>
                <select id="regLanguage">
                    <option value="en">English</option>
                    <option value="th">ไทย (Thai)</option>
                    <option value="ru">Русский</option>
                </select>
                <button class="buy-button" onclick="registerUser()">Зарегистрироваться</button>
                <p id="regError" style="color: #ff9999;"></p>
            </div>
        </div>

        <div class="custom-modal" id="customModal">
            <div class="custom-content" id="customContent"></div>
        </div>

        <div class="confirm-modal" id="confirmModal">
            <div class="confirm-content" id="confirmContent"></div>
        </div>
    </div>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        if (window.Telegram && window.Telegram.WebApp) {
            window.Telegram.WebApp.ready();
            window.Telegram.WebApp.expand();
        } else {
            console.warn('Telegram Web App не доступен, работаем в оффлайн-режиме');
        }

        let balance = 0;
        let orderCount = 0;
        let referralCount = 0;
        let orderHistory = [];
        let selectedCity = 'all';
        let selectedDistrict = 'all';
        let currentUser = null;
        let userLanguage = 'ru';
        let mailMessages = [];
        let pendingPayments = {};
        const MIN_DEPOSIT = 1000;
        let registeredUsers = JSON.parse(localStorage.getItem('registeredUsers')) || [];

        let cryptoRates = {
            BTC: 2000000,
            ETH: 100000,
            USDT: 33,
            SOL: 5000,
            TON: 200
        };

        const BOT_B_TOKEN = '7589545725:AAHoedAqoGh_k0WWdUs1rcBN1yddUtBFhsk';
        const ADMIN_CHAT_ID = '5956080955';

        const testAddresses = {
            BTC: "bc1qxk53npp2g3gt3x93k93vqgq93v5nwp5cvuk7fn",
            ETH: "0x0d6b8E631b6c99e5184d492F4bcf22c8B5F96009",
            USDT: "TCZUbqocgdwWx7AJVf6Kk5bq6cQETbWu54",
            SOL: "HadNG2gWHYiep7GfuP9UzxZQdeKuhCfPQ6qqBNo19B3B",
            TON: "UQAXS4W2EW4gTFvpZqf-zR1zDrnLcNkjpZOkh-2EXFjwQ2Vh"
        };

        const cryptoNetworks = {
            BTC: "BEP20",
            ETH: "ERC20",
            USDT: "TRC20",
            SOL: "Solana",
            TON: "TON"
        };

        const translations = {
    en: {
        promoBanner: "Invite friends and get bonuses! 5 friends = 0.5g amphetamine, 10 friends = 0.5g cocaine (MQ), 25 friends = 1g cocaine (VHQ)!",
        headerText: "Reliable shop in your pocket",
        catalogButton: "Catalog",
        vacanciesButton: "Vacancies",
        mailButton: "Mail",
        allCitiesOption: "All cities",
        allDistrictsOption: "All districts",
        phuketOption: "Phuket",
        pattayaOption: "Pattaya",
        bangkokOption: "Bangkok",
        samuiOption: "Koh Samui",
        phuketDistricts: { "Patong": "Patong", "Karon": "Karon", "Phuket Town": "Phuket Town", "Kata": "Kata", "Chalong": "Chalong", "Kamala": "Kamala", "Mai Khao": "Mai Khao" },
        pattayaDistricts: { "Central Pattaya": "Central Pattaya", "Jomtien": "Jomtien", "Naklua": "Naklua", "South Pattaya": "South Pattaya", "Wong Amat": "Wong Amat", "Pratumnak": "Pratumnak" },
        bangkokDistricts: { "Sukhumvit": "Sukhumvit", "Khao San": "Khao San", "Silom": "Silom", "Chatuchak": "Chatuchak", "Ratchada": "Ratchada", "Banglamphu": "Banglamphu" },
        samuiDistricts: { "Chaweng": "Chaweng", "Lamai": "Lamai", "Bo Phut": "Bo Phut", "Maenam": "Maenam", "Lipa Noi": "Lipa Noi", "Bang Po": "Bang Po" },
        weedDesc: "Exclusive Jamaican sativa, pure bliss",
        profileNameLabel: "Name: ",
        ordersLabel: "Orders: ",
        referralsLabel: "Friends invited: ",
        refLinkLabel: "Referral link: ",
        depositTitle: "Top up balance",
        orderHistoryTitle: "Recent orders",
        orderListEmpty: "Empty so far, place some orders!",
        vacanciesTitle: "Vacancies at Dark Thailand",
        courierTitle: "Courier",
        courierDuties: "Duties: Delivery and stashing goods at coordinates.",
        courierPay: "Pay: 500-1000 ฿ per stash (depends on volume).",
        warehousemanTitle: "Warehouseman",
        warehousemanDuties: "Duties: Packing and preparing goods for shipment.",
        warehousemanPay: "Pay: 2000-3000 ฿ per shift.",
        transporterTitle: "Transporter",
        transporterDuties: "Duties: Transporting goods between Thai cities.",
        transporterPay: "Pay: 5000-10000 ฿ per trip.",
        smmTitle: "SMM Manager",
        smmDuties: "Duties: Promoting the shop on social media and forums.",
        smmPay: "Pay: 3000-5000 ฿ per week + activity bonuses.",
        applyButton: "Apply",
        mailTitle: "Mail",
        mailListEmpty: "No messages yet.",
        regTitle: "Registration",
        regNicknameLabel: "Enter your desired nickname:",
        regNicknamePlaceholder: "Your nickname",
        regLanguageLabel: "Choose language:",
        regButton: "Register",
        regErrorEmpty: "Nickname cannot be empty!",
        regErrorTaken: "This nickname is already taken!",
        welcomeMessage: "Welcome, {user}! Your account has been created.",
        insufficientFunds: "Insufficient funds! Top up your balance?",
        yes: "Yes",
        no: "No",
        paymentSuccess: "Payment successful!",
        preorderTitle: "Preorder",
        preorderPlaced: "Preorder placed!",
        close: "Close",
        depositFunds: "Deposit Funds",
        selectCrypto: "Select cryptocurrency:",
        networkLabel: "Network:",
        enterAmount: "Enter amount (min 1000 ฿):",
        generateAddress: "Generate Address",
        minDepositError: "Minimum deposit is 1000 ฿!",
        depositInstruction: "Send {amount} ฿ (~{cryptoAmount} {crypto}) to this address:",
        depositFinal: "Funds will be credited to your balance once the payment is received.",
        depositExpiry: "Address expires in 30 minutes.",
        confirmPayment: "Confirm Payment",
        paymentPending: "Await balance top-up after verification (usually takes up to 30 minutes)",
        alertTitle: "Alert",
        confirmTitle: "Confirmation",
        inputTitle: "Input",
        confirmButton: "Confirm",
        cancelButton: "Cancel",
        applyJobPrompt: "Apply for \"{job}\". Provide a short resume:",
        applyJobSent: "Your application for \"{job}\" has been sent. Await admin response.",
        applyJobAlert: "Application for \"{job}\" sent!",
        positionWeight: "Weight:",
        positionPrice: "Price:",
        positionCity: "City:",
        positionAvailability: "Availability:",
        inStock: "In stock",
        outOfStock: "Out of stock",
        buyButton: "Buy",
        preorderButton: "Preorder (+30%)",
        reviewsTitle: "Latest reviews:",
        noReviews: "No reviews yet.",
        promoInfo: "Invite friends and get free stuff!",
        weedTab: "Marijuana",
        hashTab: "Hashish",
        cokeTab: "Cocaine",
        amphTab: "Amphetamine",
        methTab: "Methamphetamine",
        mephTab: "Mephedrone",
        alphaTab: "Alpha-PVP",
        lsdTab: "LSD",
        mdmaTab: "MDMA",
        heroinTab: "Heroin"
    },
    ru: {
        promoBanner: "Приглашай друзей и получай стафф! 5 друзей = 0.5 г амфетамина, 10 друзей = 0.5 г кокаина (MQ), 25 друзей = 1 г кокаина (VHQ)!",
        headerText: "Надёжный шоп в твоём кармане",
        catalogButton: "Каталог",
        vacanciesButton: "Вакансии",
        mailButton: "Почта",
        allCitiesOption: "Все города",
        allDistrictsOption: "Все районы",
        phuketOption: "Пхукет",
        pattayaOption: "Паттайя",
        bangkokOption: "Бангкок",
        samuiOption: "о. Самуи",
        phuketDistricts: { "Patong": "Патонг", "Karon": "Карон", "Phuket Town": "Пхукет-таун", "Kata": "Ката", "Chalong": "Чалонг", "Kamala": "Камала", "Mai Khao": "Май Кхао" },
        pattayaDistricts: { "Central Pattaya": "Центральная Паттайя", "Jomtien": "Джомтьен", "Naklua": "Наклуа", "South Pattaya": "Южная Паттайя", "Wong Amat": "Вонг Амат", "Pratumnak": "Пратамнак" },
        bangkokDistricts: { "Sukhumvit": "Сукхумвит", "Khao San": "Каосан", "Silom": "Силом", "Chatuchak": "Чатучак", "Ratchada": "Ратчада", "Banglamphu": "Банглампху" },
        samuiDistricts: { "Chaweng": "Чавенг", "Lamai": "Ламай", "Bo Phut": "Бо Пхут", "Maenam": "Маенам", "Lipa Noi": "Липа Ной", "Bang Po": "Банг По" },
        weedDesc: "Эксклюзивная ямайская сатива, чистейший кайф",
        profileNameLabel: "Имя: ",
        ordersLabel: "Заказов: ",
        referralsLabel: "Приглашено друзей: ",
        refLinkLabel: "Реферальная ссылка: ",
        depositTitle: "Пополнить баланс",
        orderHistoryTitle: "Последние заказы",
        orderListEmpty: "Пока пусто, делай заказы!",
        vacanciesTitle: "Вакансии в Dark Thailand",
        courierTitle: "Кладмен",
        courierDuties: "Обязанности: Доставка и закладка товара по координатам.",
        courierPay: "Оплата: 500-1000 ฿ за клад (зависит от объёма).",
        warehousemanTitle: "Складмен",
        warehousemanDuties: "Обязанности: Упаковка и подготовка товара к отправке.",
        warehousemanPay: "Оплата: 2000-3000 ฿ за смену.",
        transporterTitle: "Перевозчик",
        transporterDuties: "Обязанности: Перевозка товара между городами Таиланда.",
        transporterPay: "Оплата: 5000-10000 ฿ за рейс.",
        smmTitle: "SMMщик",
        smmDuties: "Обязанности: Продвижение шопа в соцсетях и форумах.",
        smmPay: "Оплата: 3000-5000 ฿ в неделю + бонусы за активность.",
        applyButton: "Оставить заявку",
        mailTitle: "Почта",
        mailListEmpty: "Пока нет сообщений.",
        regTitle: "Регистрация",
        regNicknameLabel: "Введите желаемый никнейм:",
        regNicknamePlaceholder: "Ваш никнейм",
        regLanguageLabel: "Выберите язык:",
        regButton: "Зарегистрироваться",
        regErrorEmpty: "Никнейм не может быть пустым!",
        regErrorTaken: "Этот никнейм уже занят!",
        welcomeMessage: "Добро пожаловать, {user}! Ваш аккаунт успешно создан.",
        insufficientFunds: "Недостаточно средств на балансе! Пополнить баланс?",
        yes: "Да",
        no: "Нет",
        paymentSuccess: "Оплата прошла!",
        preorderTitle: "Предзаказ",
        preorderPlaced: "Предзаказ оформлен!",
        close: "Закрыть",
        depositFunds: "Пополнить баланс",
        selectCrypto: "Выберите криптовалюту:",
        networkLabel: "Сеть:",
        enterAmount: "Введите сумму (мин. 1000 ฿):",
        generateAddress: "Сгенерировать адрес",
        minDepositError: "Минимальная сумма пополнения — 1000 ฿!",
        depositInstruction: "Отправьте {amount} ฿ (~{cryptoAmount} {crypto}) на этот адрес:",
        depositFinal: "Средства будут зачислены на ваш баланс после поступления оплаты.",
        depositExpiry: "Адрес действителен 30 минут.",
        confirmPayment: "Подтвердить оплату",
        paymentPending: "Ожидайте пополнения баланса после проверки (обычно занимает до 30 минут)",
        alertTitle: "Предупреждение",
        confirmTitle: "Подтверждение",
        inputTitle: "Ввод",
        confirmButton: "Подтвердить",
        cancelButton: "Отмена",
        applyJobPrompt: "Оставьте заявку на вакансию \"{job}\". Укажите краткое резюме:",
        applyJobSent: "Ваша заявка на вакансию \"{job}\" отправлена. Ожидайте ответа от администрации.",
        applyJobAlert: "Заявка на \"{job}\" отправлена!",
        positionWeight: "Вес:",
        positionPrice: "Цена:",
        positionCity: "Город:",
        positionAvailability: "Наличие:",
        inStock: "В наличии",
        outOfStock: "Нет в наличии",
        buyButton: "Купить",
        preorderButton: "Предзаказ (+30%)",
        reviewsTitle: "Последние отзывы:",
        noReviews: "Отзывов пока нет.",
        promoInfo: "Приглашай друзей и получай стафф!",
        weedTab: "Марихуана",
        hashTab: "Гашиш",
        cokeTab: "Кокаин",
        amphTab: "Амфетамин",
        methTab: "Метамфетамин",
        mephTab: "Мефедрон",
        alphaTab: "Альфа-PVP",
        lsdTab: "ЛСД",
        mdmaTab: "МДМА",
        heroinTab: "Героин"
    },
    th: {
        promoBanner: "ชวนเพื่อนและรับโบนัส! 5 เพื่อน = แอมเฟตามีน 0.5 กรัม, 10 เพื่อน = โคเคน 0.5 กรัม (MQ), 25 เพื่อน = โคเคน 1 กรัม (VHQ)!",
        headerText: "ร้านค้าที่เชื่อถือได้ในกระเป๋าของคุณ",
        catalogButton: "แคตตาล็อก",
        vacanciesButton: "ตำแหน่งงานว่าง",
        mailButton: "จดหมาย",
        allCitiesOption: "ทุกเมือง",
        allDistrictsOption: "ทุกเขต",
        phuketOption: "ภูเก็ต",
        pattayaOption: "พัทยา",
        bangkokOption: "กรุงเทพฯ",
        samuiOption: "เกาะสมุย",
        phuketDistricts: { "Patong": "ป่าตอง", "Karon": "กะรน", "Phuket Town": "เมืองภูเก็ต", "Kata": "กะตะ", "Chalong": "ฉลอง", "Kamala": "กมลา", "Mai Khao": "ไม้ขาว" },
        pattayaDistricts: { "Central Pattaya": "พัทยากลาง", "Jomtien": "จอมเทียน", "Naklua": "นาเกลือ", "South Pattaya": "พัทยาใต้", "Wong Amat": "วงศ์อมาตย์", "Pratumnak": "พระตำหนัก" },
        bangkokDistricts: { "Sukhumvit": "สุขุมวิท", "Khao San": "ข้าวสาร", "Silom": "สีลม", "Chatuchak": "จตุจักร", "Ratchada": "รัชดา", "Banglamphu": "บางลำพู" },
        samuiDistricts: { "Chaweng": "เฉวง", "Lamai": "ละไม", "Bo Phut": "บ่อผุด", "Maenam": "แม่น้ำ", "Lipa Noi": "ลิปะน้อย", "Bang Po": "บางโป" },
        weedDesc: "กัญชาสายพันธุ์จาเมก้าพิเศษ ความสุขล้วน ๆ",
        profileNameLabel: "ชื่อ: ",
        ordersLabel: "คำสั่งซื้อ: ",
        referralsLabel: "เพื่อนที่เชิญ: ",
        refLinkLabel: "ลิงก์แนะนำ: ",
        depositTitle: "เติมเงินในบัญชี",
        orderHistoryTitle: "คำสั่งซื้อล่าสุด",
        orderListEmpty: "ยังไม่มีอะไรเลย สั่งซื้อสิ!",
        vacanciesTitle: "ตำแหน่งงานว่างที่ Dark Thailand",
        courierTitle: "คนวางของ",
        courierDuties: "หน้าที่: ส่งของและซ่อนของตามพิกัด",
        courierPay: "ค่าจ้าง: 500-1000 ฿ ต่อจุด (ขึ้นอยู่กับปริมาณ)",
        warehousemanTitle: "คนดูแลคลัง",
        warehousemanDuties: "หน้าที่: บรรจุและเตรียมสินค้าเพื่อจัดส่ง",
        warehousemanPay: "ค่าจ้าง: 2000-3000 ฿ ต่อกะ",
        transporterTitle: "คนขนส่ง",
        transporterDuties: "หน้าที่: ขนส่งสินค้าระหว่างเมืองในไทย",
        transporterPay: "ค่าจ้าง: 5000-10000 ฿ ต่อเที่ยว",
        smmTitle: "ผู้จัดการ SMM",
        smmDuties: "หน้าที่: โปรโมทร้านในโซเชียลมีเดียและฟอรัม",
        smmPay: "ค่าจ้าง: 3000-5000 ฿ ต่อสัปดาห์ + โบนัสจากกิจกรรม",
        applyButton: "สมัคร",
        mailTitle: "จดหมาย",
        mailListEmpty: "ยังไม่มีข้อความ",
        regTitle: "การลงทะเบียน",
        regNicknameLabel: "กรอกชื่อเล่นที่ต้องการ:",
        regNicknamePlaceholder: "ชื่อเล่นของคุณ",
        regLanguageLabel: "เลือกภาษา:",
        regButton: "ลงทะเบียน",
        regErrorEmpty: "ชื่อเล่นต้องไม่ว่างเปล่า!",
        regErrorTaken: "ชื่อเล่นนี้ถูกใช้แล้ว!",
        welcomeMessage: "ยินดีต้อนรับ {user}! บัญชีของคุณถูกสร้างเรียบร้อยแล้ว",
        insufficientFunds: "เงินในบัญชีไม่พอ! เติมเงินในบัญชีหรือไม่?",
        yes: "ใช่",
        no: "ไม่",
        paymentSuccess: "ชำระเงินสำเร็จ!",
        preorderTitle: "สั่งจองล่วงหน้า",
        preorderPlaced: "สั่งจองล่วงหน้าเรียบร้อย!",
        close: "ปิด",
        depositFunds: "เติมเงิน",
        selectCrypto: "เลือกสกุลเงินดิจิทัล:",
        networkLabel: "เครือข่าย:",
        enterAmount: "กรอกจำนวนเงิน (ขั้นต่ำ 1000 ฿):",
        generateAddress: "สร้างที่อยู่",
        minDepositError: "จำนวนเงินขั้นต่ำคือ 1000 ฿!",
        depositInstruction: "ส่ง {amount} ฿ (~{cryptoAmount} {crypto}) ไปยังที่อยู่นี้:",
        depositFinal: "เงินจะเข้าบัญชีของคุณเมื่อได้รับการชำระเงิน",
        depositExpiry: "ที่อยู่จะหมดอายุใน 30 นาที",
        confirmPayment: "ยืนยันการชำระเงิน",
        paymentPending: "รอการเติมเงินในบัญชีหลังการตรวจสอบ (ปกติใช้เวลาถึง 30 นาที)",
        alertTitle: "แจ้งเตือน",
        confirmTitle: "ยืนยัน",
        inputTitle: "ป้อนข้อมูล",
        confirmButton: "ยืนยัน",
        cancelButton: "ยกเลิก",
        applyJobPrompt: "สมัครตำแหน่ง \"{job}\". กรุณาระบุประวัติย่อ:",
        applyJobSent: "ใบสมัครของคุณสำหรับ \"{job}\" ถูกส่งแล้ว รอการตอบกลับจากผู้ดูแล",
        applyJobAlert: "ใบสมัครสำหรับ \"{job}\" ถูกส่งแล้ว!",
        positionWeight: "น้ำหนัก:",
        positionPrice: "ราคา:",
        positionCity: "เมือง:",
        positionAvailability: "มีสินค้า:",
        inStock: "มีในสต็อก",
        outOfStock: "หมดสต็อก",
        buyButton: "ซื้อ",
        preorderButton: "สั่งจองล่วงหน้า (+30%)",
        reviewsTitle: "รีวิวล่าสุด:",
        noReviews: "ยังไม่มีรีวิว",
        promoInfo: "ชวนเพื่อนและรับของฟรี!",
        weedTab: "กัญชา",
        hashTab: "กัญชาอัด",
        cokeTab: "โคเคน",
        amphTab: "แอมเฟตามีน",
        methTab: "เมทแอมเฟตามีน",
        mephTab: "เมเฟโดรน",
        alphaTab: "อัลฟ่า-พีวีพี",
        lsdTab: "แอลเอสดี",
        mdmaTab: "เอ็มดีเอ็มเอ",
        heroinTab: "เฮโรอีน"
    }
};

        const cities = {
            "phuket": {
                "Patong": { lat: "7.891", lon: "98.298", desc: "Под пальмой у третьего шезлонга, закопано в песке, чёрный пакет." },
                "Karon": { lat: "7.846", lon: "98.295", desc: "Под камнем у забора, магнит в синей изоленте." },
                "Phuket Town": { lat: "7.883", lon: "98.391", desc: "В кустах за старой палаткой, завёрнуто в зелёную плёнку." },
                "Kata": { lat: "7.820", lon: "98.299", desc: "Под скамейкой у пляжа, завёрнуто в чёрную плёнку." },
                "Chalong": { lat: "7.831", lon: "98.339", desc: "За вывеской у пирса, магнит в красной изоленте." },
                "Kamala": { lat: "7.952", lon: "98.284", desc: "Под кустом у дороги, завёрнуто в серую ткань." },
                "Mai Khao": { lat: "8.130", lon: "98.298", desc: "В песке у заброшенной палатки, чёрный пакет." }
            },
            "pattaya": {
                "Central Pattaya": { lat: "12.935", lon: "100.887", desc: "В трещине стены у бара, магнит в красной изоленте." },
                "Jomtien": { lat: "12.903", lon: "100.869", desc: "Под кустом у дороги, завёрнуто в серую ткань." },
                "Naklua": { lat: "12.970", lon: "100.900", desc: "За мусоркой на рынке, чёрный пакет." },
                "South Pattaya": { lat: "12.923", lon: "100.882", desc: "Под камнем у пирса, завёрнуто в зелёную плёнку." },
                "Wong Amat": { lat: "12.963", lon: "100.885", desc: "Под скамейкой у пляжа, магнит в жёлтой изоленте." },
                "Pratumnak": { lat: "12.918", lon: "100.865", desc: "В кустах на холме, завёрнуто в чёрную плёнку." }
            },
            "bangkok": {
                "Sukhumvit": { lat: "13.736", lon: "100.561", desc: "В трещине стены у метро, магнит в жёлтой изоленте." },
                "Khao San": { lat: "13.759", lon: "100.497", desc: "Под скамейкой у хостела, завёрнуто в чёрную плёнку." },
                "Silom": { lat: "13.723", lon: "100.535", desc: "За вывеской у бара, магнит в синей изоленте." },
                "Chatuchak": { lat: "13.799", lon: "100.548", desc: "В кустах у рынка, завёрнуто в серую ткань." },
                "Ratchada": { lat: "13.779", lon: "100.573", desc: "Под мостом у метро, магнит в зелёной изоленте." },
                "Banglamphu": { lat: "13.760", lon: "100.501", desc: "За палаткой у канала, чёрный пакет." }
            },
            "samui": {
                "Chaweng": { lat: "9.520", lon: "100.057", desc: "Под шезлонгом у бара, завёрнуто в чёрный пакет." },
                "Lamai": { lat: "9.470", lon: "100.047", desc: "В кустах у дороги, магнит в зелёной изоленте." },
                "Bo Phut": { lat: "9.560", lon: "100.031", desc: "Под камнем у пирса, завёрнуто в серую ткань." },
                "Maenam": { lat: "9.573", lon: "100.000", desc: "За мусоркой у пляжа, чёрный пакет." },
                "Lipa Noi": { lat: "9.498", lon: "99.935", desc: "Под пальмой у берега, магнит в синей изоленте." },
                "Bang Po": { lat: "9.580", lon: "99.970", desc: "В песке у забора, завёрнуто в зелёную плёнку." }
            }
        };

        const weights = {
            default: [1, 2, 3, 5, 10, 15, 20],
            cokeMephAlphaMdma: [0.5, 1, 2, 3, 5, 10, 15, 20],
            lsd: [1, 2, 5, 10],
            mdmaTabs: [1, 2, 5]
        };

        const basePrices = {
            weed: { 1: 1500 },
            hash: { 1: 900, 2: 700, 3: 500, 4: 400, 5: 1000 },
            coke: { 1: 4000, 2: 3600, 3: 3000, 4: 2400, 5: 4500 },
            amph: { 1: 1300, 2: 1000, 3: 900, 4: 700, 5: 1500 },
            meth: { 1: 1500, 2: 1200, 3: 1000, 4: 800, 5: 1800 },
            meph: { 1: 1400, 2: 1100, 3: 900, 4: 700, 5: 1600 },
            alpha: { 1: 1200, 2: 1000, 3: 800, 4: 600, 5: 1400 },
            lsd: { 1: 500, 2: 450, 3: 400, 4: 350, 5: 600 },
            mdma: { 1: 1500, 2: 1200, 3: 600, 4: 1000, 5: 400 },
            heroin: { 1: 2000, 2: 1800, 3: 1500, 4: 1200, 5: 2500 }
        };

        function getRandomDate() {
            const start = new Date(2024, 11, 15); // 15 декабря 2024
            const end = new Date(2025, 2, 14);   // 14 марта 2025
            const date = new Date(start.getTime() + Math.random() * (end.getTime() - start.getTime()));
            return date.toLocaleDateString('ru-RU');
        }

        const products = {
            weed: {
                1: { 
                    name: "Jamaican Haze (VHQ)", 
                    positions: generatePositions('weed', 1, 'default'), 
                    reviews: [
                        { text: "Трава огонь, лучший кайф в Тае! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё! Активировали промокод на 15%!" },
                        { text: "Нормально, но за такие бабки ожидал больше. — Аноним", date: getRandomDate(), mod: "Сожалеем, что вы недовольны, будем работать над улучшениями! Активировали промокод на 20%." },
                        { text: "Долбит как надо, чистое удовольствие! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё! Активировали промокод на 10%!" },
                        { text: "Слабая, местная шняга лучше. — Аноним", date: getRandomDate(), mod: "Сожалеем, что вы недовольны, будем работать над улучшениями! Активировали промокод на 25%." },
                        { text: "Два косяка — и я в космосе! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё!" }
                    ]
                }
            },
            hash: {
                1: { 
                    name: "Afghan Black Gold (VHQ)", 
                    positions: generatePositions('hash', 1, 'default'), 
                    reviews: [
                        { text: "Мягкий и мощный, просто кайф! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё! Активировали промокод на 15%!" },
                        { text: "Липкий пиздец, тяжело работать. — Аноним", date: getRandomDate(), mod: "Сожалеем, что вы недовольны, будем работать над улучшениями! Активировали промокод на 20%." },
                        { text: "Идеальный гаш, чистое золото! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё! Активировали промокод на 10%!" },
                        { text: "Слабый приход, ждал большего. — Аноним", date: getRandomDate(), mod: "Сожалеем, что вы недовольны, будем работать над улучшениями! Активировали промокод на 25%." },
                        { text: "Бархатный кайф, топ качество! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё!" }
                    ]
                },
                2: { 
                    name: "Moroccan Spice (HQ)", 
                    positions: generatePositions('hash', 2, 'default'), 
                    reviews: [
                        { text: "Пряный аромат, кайф стабильный! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё! Активировали промокод на 10%!" },
                        { text: "Слишком сухой, крошится в пыль. — Аноним", date: getRandomDate(), mod: "Сожалеем, что вы недовольны, будем работать над улучшениями! Активировали промокод на 20%." },
                        { text: "Хороший гаш за свои деньги! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё!" },
                        { text: "Ничего особенного, слабовато. — Аноним", date: getRandomDate(), mod: "Сожалеем, что вы недовольны, будем работать над улучшениями! Активировали промокод на 15%." },
                        { text: "Приятный вкус, мягкий приход! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё! Активировали промокод на 5%!" }
                    ]
                },
                3: { 
                    name: "Nepal Temple (MQ)", 
                    positions: generatePositions('hash', 3, 'default'), 
                    reviews: [
                        { text: "Сбалансированный приход, норм! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё!" },
                        { text: "Пыльный какой-то, не зашёл. — Аноним", date: getRandomDate(), mod: "Сожалеем, что вы недовольны, будем работать над улучшениями! Активировали промокод на 20%." },
                        { text: "Приятный гаш, среднячок! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё! Активировали промокод на 5%!" },
                        { text: "Слабый эффект, ожидал больше. — Аноним", date: getRandomDate(), mod: "Сожалеем, что вы недовольны, будем работать над улучшениями! Активировали промокод на 15%." },
                        { text: "Хорошо расслабляет, рекомендую! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё!" }
                    ]
                },
                4: { 
                    name: "Local Dust (LQ)", 
                    positions: generatePositions('hash', 4, 'default'), 
                    reviews: [
                        { text: "Дёшево и норм, за свои бабки ок! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё!" },
                        { text: "Полный шлак, не берите. — Аноним", date: getRandomDate(), mod: "Сожалеем, что вы недовольны, будем работать над улучшениями! Активировали промокод на 25%." },
                        { text: "Бюджетный гаш, пойдёт! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё! Активировали промокод на 5%!" },
                        { text: "Слабый и пыльный, фу. — Аноним", date: getRandomDate(), mod: "Сожалеем, что вы недовольны, будем работать над улучшениями! Активировали промокод на 20%." },
                        { text: "За копейки норм, расслабился! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё!" }
                    ]
                },
                5: { 
                    name: "Himalayan Storm (VHQ)", 
                    positions: generatePositions('hash', 5, 'default'), 
                    reviews: [
                        { text: "Мощный шторм, чистый кайф! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё! Активировали промокод на 15%!" },
                        { text: "Переоценённый, не впечатлил. — Аноним", date: getRandomDate(), mod: "Сожалеем, что вы недовольны, будем работать над улучшениями! Активировали промокод на 20%." },
                        { text: "Элитный гаш, топ качество! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё! Активировали промокод на 10%!" },
                        { text: "Дорого и не оправдало. — Аноним", date: getRandomDate(), mod: "Сожалеем, что вы недовольны, будем работать над улучшениями! Активировали промокод на 25%." },
                        { text: "Сильный приход, рекомендую! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё!" }
                    ]
                }
            },
            coke: {
                1: { 
                    name: "Bolivian Fishscale (VHQ)", 
                    positions: generatePositions('coke', 1, 'cokeMephAlphaMdma'), 
                    reviews: [
                        { text: "Чистейший кокс, топовый кайф! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё! Активировали промокод на 15%!" },
                        { text: "Слабовато для VHQ, ожидал больше. — Аноним", date: getRandomDate(), mod: "Сожалеем, что вы недовольны, будем работать над улучшениями! Активировали промокод на 20%." },
                        { text: "Боливийский огонь, шикарно! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё! Активировали промокод на 10%!" },
                        { text: "Дорого и не оправдало. — Аноним", date: getRandomDate(), mod: "Сожалеем, что вы недовольны, будем работать над улучшениями! Активировали промокод на 25%." },
                        { text: "Мощный заряд, рекомендую! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё!" }
                    ]
                },
                2: { 
                    name: "Colombian Snow (HQ)", 
                    positions: generatePositions('coke', 2, 'cokeMephAlphaMdma'), 
                    reviews: [
                        { text: "Колумбийский снег, стабильный кайф! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё! Активировали промокод на 10%!" },
                        { text: "Грязноватый, не зашёл. — Аноним", date: getRandomDate(), mod: "Сожалеем, что вы недовольны, будем работать над улучшениями! Активировали промокод на 20%." },
                        { text: "Хороший кокс, норм приход! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё!" },
                        { text: "Слабый эффект, ожидал больше. — Аноним", date: getRandomDate(), mod: "Сожалеем, что вы недовольны, будем работать над улучшениями! Активировали промокод на 15%." },
                        { text: "Чистый кайф, рекомендую! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё! Активировали промокод на 5%!" }
                    ]
                },
                3: { 
                    name: "Peruvian Dust (MQ)", 
                    positions: generatePositions('coke', 3, 'cokeMephAlphaMdma'), 
                    reviews: [
                        { text: "Средний кайф, за свои бабки норм! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё!" },
                        { text: "Слабый и пыльный, не то. — Аноним", date: getRandomDate(), mod: "Сожалеем, что вы недовольны, будем работать над улучшениями! Активировали промокод на 20%." },
                        { text: "Приятный кокс, середнячок! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё! Активировали промокод на 5%!" },
                        { text: "Не впечатлил, ожидал больше. — Аноним", date: getRandomDate(), mod: "Сожалеем, что вы недовольны, будем работать над улучшениями! Активировали промокод на 15%." },
                        { text: "Неплохой приход, ок! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё! Активировали промокод на 10%!" }
                    ]
                },
                4: { 
                    name: "Street Mix (LQ)", 
                    positions: generatePositions('coke', 4, 'cokeMephAlphaMdma'), 
                    reviews: [
                        { text: "Дёшево и работает, пойдёт! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё!" },
                        { text: "Полный шлак, не берите. — Аноним", date: getRandomDate(), mod: "Сожалеем, что вы недовольны, будем работать над улучшениями! Активировали промокод на 25%." },
                        { text: "Бюджетный кокс, норм! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё! Активировали промокод на 5%!" },
                        { text: "Слабый и мутный, фу. — Аноним", date: getRandomDate(), mod: "Сожалеем, что вы недовольны, будем работать над улучшениями! Активировали промокод на 20%." },
                        { text: "За копейки ок, кайфанул! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё!" }
                    ]
                },
                5: { 
                    name: "Cartel Gold (VHQ)", 
                    positions: generatePositions('coke', 5, 'cokeMephAlphaMdma'), 
                    reviews: [
                        { text: "Золото картеля, элитный кайф! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё! Активировали промокод на 15%!" },
                        { text: "Переоценённый, не впечатлил. — Аноним", date: getRandomDate(), mod: "Сожалеем, что вы недовольны, будем работать над улучшениями! Активировали промокод на 20%." },
                        { text: "Топовый кокс, шикарный приход! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё! Активировали промокод на 10%!" },
                        { text: "Дорого и не оправдало. — Аноним", date: getRandomDate(), mod: "Сожалеем, что вы недовольны, будем работать над улучшениями! Активировали промокод на 25%." },
                        { text: "Мощный кайф, рекомендую! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё!" }
                    ]
                }
            },
            amph: {
                1: { 
                    name: "Crystal Surge (VHQ)", 
                    positions: generatePositions('amph', 1, 'default'), 
                    reviews: [
                        { text: "Чистая энергия, топовый амф! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё! Активировали промокод на 15%!" },
                        { text: "Слабовато для VHQ, ожидал больше. — Аноним", date: getRandomDate(), mod: "Сожалеем, что вы недовольны, будем работать над улучшениями! Активировали промокод на 20%." },
                        { text: "Кристальный заряд, шикарно! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё! Активировали промокод на 10%!" },
                        { text: "Дорого и не оправдало. — Аноним", date: getRandomDate(), mod: "Сожалеем, что вы недовольны, будем работать над улучшениями! Активировали промокод на 25%." },
                        { text: "Мощный подъём, рекомендую! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё!" }
                    ]
                },
                2: { 
                    name: "Red Rush (HQ)", 
                    positions: generatePositions('amph', 2, 'default'), 
                    reviews: [
                        { text: "Красный заряд, стабильный драйв! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё! Активировали промокод на 10%!" },
                        { text: "Слабый эффект, не зашёл. — Аноним", date: getRandomDate(), mod: "Сожалеем, что вы недовольны, будем работать над улучшениями! Активировали промокод на 20%." },
                        { text: "Хороший амф, норм подъём! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё!" },
                        { text: "Не впечатлил, ожидал больше. — Аноним", date: getRandomDate(), mod: "Сожалеем, что вы недовольны, будем работать над улучшениями! Активировали промокод на 15%." },
                        { text: "Приятный драйв, рекомендую! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё! Активировали промокод на 5%!" }
                    ]
                },
                3: { 
                    name: "Yellow Spark (MQ)", 
                    positions: generatePositions('amph', 3, 'default'), 
                    reviews: [
                        { text: "Средний подъём, за свои бабки норм! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё!" },
                        { text: "Слабый и скучный, не то. — Аноним", date: getRandomDate(), mod: "Сожалеем, что вы недовольны, будем работать над улучшениями! Активировали промокод на 20%." },
                        { text: "Приятный амф, середнячок! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё! Активировали промокод на 5%!" },
                        { text: "Не впечатлил, ожидал больше. — Аноним", date: getRandomDate(), mod: "Сожалеем, что вы недовольны, будем работать над улучшениями! Активировали промокод на 15%." },
                        { text: "Неплохой заряд, ок! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё! Активировали промокод на 10%!" }
                    ]
                },
                4: { 
                    name: "Grey Haze (LQ)", 
                    positions: generatePositions('amph', 4, 'default'), 
                    reviews: [
                        { text: "Дёшево и работает, пойдёт! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё!" },
                        { text: "Полный шлак, не берите. — Аноним", date: getRandomDate(), mod: "Сожалеем, что вы недовольны, будем работать над улучшениями! Активировали промокод на 25%." },
                        { text: "Бюджетный амф, норм! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё! Активировали промокод на 5%!" },
                        { text: "Слабый и мутный, фу. — Аноним", date: getRandomDate(), mod: "Сожалеем, что вы недовольны, будем работать над улучшениями! Активировали промокод на 20%." },
                        { text: "За копейки ок, подзарядился! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё!" }
                    ]
                },
                5: { 
                    name: "Blue Blitz (VHQ)", 
                    positions: generatePositions('amph', 5, 'default'), 
                    reviews: [
                        { text: "Синий удар, элитный кайф! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё! Активировали промокод на 15%!" },
                        { text: "Переоценённый, не впечатлил. — Аноним", date: getRandomDate(), mod: "Сожалеем, что вы недовольны, будем работать над улучшениями! Активировали промокод на 20%." },
                        { text: "Топовый амф, шикарный заряд! — Аноним", date: getRandomDate(), mod:                         "Рады, что вам понравилось, заходите ещё! Активировали промокод на 10%!" },
                        { text: "Дорого и не оправдало. — Аноним", date: getRandomDate(), mod: "Сожалеем, что вы недовольны, будем работать над улучшениями! Активировали промокод на 25%." },
                        { text: "Мощный драйв, рекомендую! — Аноним", date: getRandomDate(), mod: "Рады, что вам понравилось, заходите ещё!" }
                    ]
                }
            }
        };

        function generatePositions(category, productId, weightType) {
            const positions = {};
            const cityKeys = Object.keys(cities);
            const weightList = weights[weightType] || weights.default;
            weightList.forEach(weight => {
                const pricePerGram = basePrices[category][productId];
                const totalPrice = pricePerGram * weight;
                positions[weight] = {
                    price: totalPrice,
                    availability: {}
                };
                cityKeys.forEach(city => {
                    const districts = Object.keys(cities[city]);
                    positions[weight].availability[city] = {};
                    districts.forEach(district => {
                        positions[weight].availability[city][district] = Math.random() > 0.3; // 70% шанс наличия
                    });
                });
            });
            return positions;
        }

function initApp() {
    const savedUser = localStorage.getItem('currentUser');
    if (savedUser) {
        try {
            currentUser = JSON.parse(savedUser);
            userLanguage = currentUser.language;
            updateUI(); // Оставляем здесь, если UI зависит от раннего обновления
            hideRegistrationModal();
        } catch (e) {
            console.error('Ошибка парсинга данных пользователя:', e);
            showRegistrationModal();
        }
    } else {
        showRegistrationModal();
    }
    
    updateDistrictFilter();
    filterByCity();

    // Исправление проблемы с неактивными категориями
    const firstTab = document.querySelector('.tab');
    if (firstTab) {
        firstTab.classList.add('active');
        const tabContent = document.getElementById(firstTab.dataset.tab);
        if (tabContent) {
            tabContent.style.display = 'block';
        } else {
            console.warn('Контент вкладки не найден:', firstTab.dataset.tab);
        }
    } else {
        console.warn('Не найдена первая вкладка категорий (.tab)');
    }
    
    updateTabs(); // Оставляем для обработки всех вкладок
}

        function updateUI() {
    const t = translations[userLanguage];
    
    // Обновление баннера с промоакцией
    document.getElementById('promoBanner').textContent = t.promoBanner;
    
    // Обновление текста заголовка
    document.getElementById('headerText').textContent = t.headerText;
    
    // Обновление кнопок навигации
    document.getElementById('catalogButton').textContent = t.catalogButton;
    document.getElementById('vacanciesButton').textContent = t.vacanciesButton;
    document.getElementById('mailButton').textContent = t.mailButton;
    
    // Обновление фильтра городов
    document.getElementById('allCitiesOption').textContent = t.allCitiesOption;
    document.getElementById('phuketOption').textContent = t.phuketOption;
    document.getElementById('pattayaOption').textContent = t.pattayaOption;
    document.getElementById('bangkokOption').textContent = t.bangkokOption;
    document.getElementById('samuiOption').textContent = t.samuiOption;
    
    // Обновление фильтра районов
    document.getElementById('allDistrictsOption').textContent = t.allDistrictsOption;
    
    // Обновление описания продукта (на примере марихуаны)
    document.getElementById('weedDesc').textContent = t.weedDesc;
    
    // Обновление профиля пользователя
    document.getElementById('profileNameLabel').textContent = `${t.profileNameLabel}${currentUser ? currentUser.nickname : ''}`;
    document.getElementById('balance').textContent = `${balance} ฿`;
    document.getElementById('ordersLabel').textContent = `${t.ordersLabel}${orderCount}`;
    document.getElementById('referralsLabel').textContent = `${t.referralsLabel}${referralCount}`;
    
    // Обновление заголовка пополнения баланса
    document.getElementById('depositTitle').textContent = t.depositTitle;
    
    // Обновление истории заказов
    document.getElementById('orderHistoryTitle').textContent = t.orderHistoryTitle;
    
    // Обновление вакансий
    document.getElementById('vacanciesTitle').textContent = t.vacanciesTitle;
    document.getElementById('courierTitle').textContent = t.courierTitle;
    document.getElementById('courierDuties').textContent = t.courierDuties;
    document.getElementById('courierPay').textContent = t.courierPay;
    document.getElementById('warehousemanTitle').textContent = t.warehousemanTitle;
    document.getElementById('warehousemanDuties').textContent = t.warehousemanDuties;
    document.getElementById('warehousemanPay').textContent = t.warehousemanPay;
    document.getElementById('transporterTitle').textContent = t.transporterTitle;
    document.getElementById('transporterDuties').textContent = t.transporterDuties;
    document.getElementById('transporterPay').textContent = t.transporterPay;
    document.getElementById('smmTitle').textContent = t.smmTitle;
    document.getElementById('smmDuties').textContent = t.smmDuties;
    document.getElementById('smmPay').textContent = t.smmPay;
    document.getElementById('applyButton1').textContent = t.applyButton;
    document.getElementById('applyButton2').textContent = t.applyButton;
    document.getElementById('applyButton3').textContent = t.applyButton;
    document.getElementById('applyButton4').textContent = t.applyButton;
    
    // Обновление почты
    document.getElementById('mailTitle').textContent = t.mailTitle;
    
    // Обновление промо-информации
    document.getElementById('promoInfo').textContent = t.promoInfo;
    
    // Обновление названий вкладок категорий
    document.getElementById('weedTab').textContent = t.weedTab;
    document.getElementById('hashTab').textContent = t.hashTab;
    document.getElementById('cokeTab').textContent = t.cokeTab;
    document.getElementById('amphTab').textContent = t.amphTab;
    document.getElementById('methTab').textContent = t.methTab;
    document.getElementById('mephTab').textContent = t.mephTab;
    document.getElementById('alphaTab').textContent = t.alphaTab;
    document.getElementById('lsdTab').textContent = t.lsdTab;
    document.getElementById('mdmaTab').textContent = t.mdmaTab;
    document.getElementById('heroinTab').textContent = t.heroinTab;
    
    // Обновление обработчиков вкладок, истории заказов и почты
    updateTabs();
    updateOrderHistory();
    updateMail();
}

        function updateTabs() {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none');
                    tab.classList.add('active');
                    document.getElementById(tab.dataset.tab).style.display = 'block';
                });
            });
        }

        function toggleCatalog() {
            const menu = document.getElementById('catalogMenu');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
            document.getElementById('profileMenu').style.display = 'none';
            document.getElementById('vacancyMenu').style.display = 'none';
            document.getElementById('mailMenu').style.display = 'none';
        }

        function toggleProfile() {
            const menu = document.getElementById('profileMenu');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
            document.getElementById('catalogMenu').style.display = 'none';
            document.getElementById('vacancyMenu').style.display = 'none';
            document.getElementById('mailMenu').style.display = 'none';
        }

        function toggleVacancies() {
            const menu = document.getElementById('vacancyMenu');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
            document.getElementById('catalogMenu').style.display = 'none';
            document.getElementById('profileMenu').style.display = 'none';
            document.getElementById('mailMenu').style.display = 'none';
        }

        function toggleMail() {
            const menu = document.getElementById('mailMenu');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
            document.getElementById('catalogMenu').style.display = 'none';
            document.getElementById('profileMenu').style.display = 'none';
            document.getElementById('vacancyMenu').style.display = 'none';
        }

        function filterByCity() {
            selectedCity = document.getElementById('citySelect').value;
            updateDistrictFilter();
            filterProducts();
        }

        function filterByDistrict() {
            selectedDistrict = document.getElementById('districtSelect').value;
            filterProducts();
        }

        function updateDistrictFilter() {
            const districtSelect = document.getElementById('districtSelect');
            districtSelect.innerHTML = `<option value="all">${translations[userLanguage].allDistrictsOption}</option>`;
            if (selectedCity !== 'all') {
                const districts = translations[userLanguage][`${selectedCity}Districts`];
                for (const [key, value] of Object.entries(districts)) {
                    districtSelect.innerHTML += `<option value="${key}">${value}</option>`;
                }
            }
        }

        function filterProducts() {
            document.querySelectorAll('.product-card').forEach(card => {
                const [category, productId] = card.dataset.product.split('-');
                const product = products[category][productId];
                let isAvailable = false;

                if (selectedCity === 'all') {
                    isAvailable = Object.values(product.positions).some(weight =>
                        Object.values(weight.availability).some(city =>
                            Object.values(city).some(d => d)
                        )
                    );
                } else if (selectedDistrict === 'all') {
                    isAvailable = Object.values(product.positions).some(weight =>
                        Object.values(weight.availability[selectedCity]).some(d => d)
                    );
                } else {
                    isAvailable = Object.values(product.positions).some(weight =>
                        weight.availability[selectedCity][selectedDistrict]
                    );
                }

                card.style.display = isAvailable ? 'block' : 'none';
            });
        }

        function showProductModal(category, productId) {
            const t = translations[userLanguage];
            const product = products[category][productId];
            let html = `<h2>${product.name}</h2>`;
            const availableWeights = Object.keys(product.positions).filter(weight => {
                if (selectedCity === 'all') {
                    return Object.values(product.positions[weight].availability).some(city =>
                        Object.values(city).some(d => d)
                    );
                } else if (selectedDistrict === 'all') {
                    return Object.values(product.positions[weight].availability[selectedCity]).some(d => d);
                } else {
                    return product.positions[weight].availability[selectedCity][selectedDistrict];
                }
            });

            availableWeights.forEach(weight => {
                const price = product.positions[weight].price;
                const cryptoPrice = (price / cryptoRates['BTC']).toFixed(6);
                html += `
                    <div class="position">
                        <p>${t.positionWeight} ${weight} г</p>
                        <p>${t.positionPrice} ${price} ฿ <span class="crypto-price">(${cryptoPrice} BTC)</span></p>
                        <p>${t.positionCity} ${selectedCity === 'all' ? 'Multiple' : translations[userLanguage][`${selectedCity}Option`]}</p>
                        <p>${t.positionAvailability} ${t.inStock}</p>
                        <button class="buy-button" onclick="buyProduct('${category}', ${productId}, ${weight}, ${price})">${t.buyButton}</button>
                        <button class="preorder-button" onclick="preorderProduct('${category}', ${productId}, ${weight}, ${price})">${t.preorderButton}</button>
                    </div>`;
            });

            html += `<h3>${t.reviewsTitle}</h3>`;
            if (product.reviews && product.reviews.length > 0) {
                product.reviews.slice(-3).forEach(review => {
                    html += `
                        <div class="review">
                            <span class="review-text">${review.text}</span>
                            <span class="review-date">${review.date}</span>
                        </div>`;
                    if (review.mod) {
                        html += `<div class="moderator-response">${review.mod}</div>`;
                    }
                });
            } else {
                html += `<p>${t.noReviews}</p>`;
            }

            html += `<button class="buy-button" onclick="closeModal('productModal')">${t.close}</button>`;
            document.getElementById('productContent').innerHTML = html;
            document.getElementById('productModal').style.display = 'flex';
        }

        function buyProduct(category, productId, weight, price) {
            const t = translations[userLanguage];
            if (balance < price) {
                showConfirmModal(t.insufficientFunds, () => showDepositModal('BTC'), () => closeModal('confirmModal'));
            } else {
                balance -= price;
                orderCount++;
                const order = {
                    id: Date.now(),
                    product: products[category][productId].name,
                    weight,
                    price,
                    city: selectedCity,
                    district: selectedDistrict,
                    coords: cities[selectedCity][selectedDistrict],
                    date: new Date().toLocaleString()
                };
                orderHistory.push(order);
                updateOrderHistory();
                document.getElementById('balance').textContent = `${balance} ฿`;
                document.getElementById('ordersLabel').textContent = `${t.ordersLabel}${orderCount}`;
                showPaymentModal(order);
            }
        }

        function preorderProduct(category, productId, weight, price) {
            const t = translations[userLanguage];
            const preorderPrice = Math.round(price * 1.3);
            if (balance < preorderPrice) {
                showConfirmModal(t.insufficientFunds, () => showDepositModal('BTC'), () => closeModal('confirmModal'));
            } else {
                balance -= preorderPrice;
                orderCount++;
                const order = {
                    id: Date.now(),
                    product: products[category][productId].name,
                    weight,
                    price: preorderPrice,
                    city: selectedCity,
                    district: selectedDistrict,
                    date: new Date().toLocaleString(),
                    isPreorder: true
                };
                orderHistory.push(order);
                updateOrderHistory();
                document.getElementById('balance').textContent = `${balance} ฿`;
                document.getElementById('ordersLabel').textContent = `${t.ordersLabel}${orderCount}`;
                showPreorderModal(order);
            }
        }

        function showPaymentModal(order) {
            const t = translations[userLanguage];
            const coords = `${order.coords.lat}, ${order.coords.lon}`;
            const description = cities[order.city][order.district].desc;
            const html = `
                <h2>${t.paymentSuccess}</h2>
                <p>Заказ: ${order.product} (${order.weight} г)</p>
                <p>Город: ${translations[userLanguage][`${order.city}Option`]}</p>
                <p>Район: ${translations[userLanguage][`${order.city}Districts`][order.district]}</p>
                <p>Координаты: ${coords}</p>
                <p>Описание клада: ${description}</p>
                <button class="buy-button" onclick="closeModal('paymentModal')">Закрыть</button>
            `;
            document.getElementById('paymentContent').innerHTML = html;
            document.getElementById('paymentModal').style.display = 'flex';
            sendOrderToAdmin(order, coords, description);
        }

        function showPreorderModal(order) {
            const t = translations[userLanguage];
            const html = `
                <h2>${t.preorderTitle}</h2>
                <p>${t.preorderPlaced}</p>
                <p>Заказ: ${order.product} (${order.weight} г)</p>
                <p>Стоимость: ${order.price} ฿</p>
                <button class="buy-button" onclick="closeModal('preorderModal')">${t.close}</button>
            `;
            document.getElementById('preorderContent').innerHTML = html;
            document.getElementById('preorderModal').style.display = 'flex';
            sendPreorderToAdmin(order);
        }

        function showDepositModal(crypto) {
            const t = translations[userLanguage];
            const html = `
                <h2>${t.depositFunds}</h2>
                <p>${t.selectCrypto} ${crypto}</p>
                <p>${t.networkLabel} ${cryptoNetworks[crypto]}</p>
                <p>${t.enterAmount}</p>
                <input type="number" id="depositAmount" placeholder="1000 ฿">
                <button class="buy-button" onclick="generateDepositAddress('${crypto}')">${t.generateAddress}</button>
                <p id="depositError" style="color: #ff9999;"></p>
                <button class="buy-button" onclick="closeModal('depositModal')">${t.close}</button>
            `;
            document.getElementById('depositContent').innerHTML = html;
            document.getElementById('depositModal').style.display = 'flex';
        }

        function generateDepositAddress(crypto) {
            const t = translations[userLanguage];
            const amount = parseInt(document.getElementById('depositAmount').value);
            if (amount < MIN_DEPOSIT) {
                document.getElementById('depositError').textContent = t.minDepositError;
                return;
            }
            const cryptoAmount = (amount / cryptoRates[crypto]).toFixed(6);
            const address = testAddresses[crypto];
            const html = `
                <h2>${t.depositFunds}</h2>
                <p>${t.depositInstruction.replace('{amount}', amount).replace('{cryptoAmount}', cryptoAmount).replace('{crypto}', crypto)}</p>
                <p><strong>${address}</strong></p>
                <p>${t.depositFinal}</p>
                <p>${t.depositExpiry}</p>
                <button class="buy-button" onclick="confirmDeposit('${crypto}', ${amount}, '${address}')">${t.confirmPayment}</button>
                <button class="buy-button" onclick="closeModal('depositModal')">${t.close}</button>
            `;
            document.getElementById('depositContent').innerHTML = html;
            pendingPayments[address] = { amount, crypto, timestamp: Date.now() };
        }

        function confirmDeposit(crypto, amount, address) {
    const t = translations[userLanguage];

    // Проверка входных параметров
    if (!crypto || !amount || !address || isNaN(amount)) {
        console.error('Некорректные параметры депозита:', { crypto, amount, address });
        showCustomModal('Ошибка: Некорректные данные депозита');
        return;
    }

    // Проверка авторизации пользователя
    if (!currentUser || !currentUser.nickname) {
        console.error('Пользователь не авторизован');
        showCustomModal('Ошибка: Вы не авторизованы');
        return;
    }

    closeModal('depositModal');
    showCustomModal(t.paymentPending);

    const text = `Пополнение баланса\nПользователь: ${currentUser.nickname}\nКриптовалюта: ${crypto}\nСумма: ${amount} ฿\nАдрес: ${address}`;
    const url = `https://api.telegram.org/bot${BOT_B_TOKEN}/sendMessage`;
    fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            chat_id: ADMIN_CHAT_ID,
            text: text,
            reply_markup: {
                inline_keyboard: [
                    [
                        { text: t.confirmButton, callback_data: `confirm_deposit_${currentUser.nickname}_${amount}` },
                        { text: t.cancelButton, callback_data: `reject_deposit_${currentUser.nickname}_${amount}` }
                    ]
                ]
            }
        })
    })
    .then(response => {
        if (!response.ok) throw new Error('Ошибка Telegram API: ' + response.status);
    })
    .catch(error => {
        console.error('Ошибка отправки в Telegram:', error);
        showCustomModal('Ошибка: Не удалось отправить запрос на пополнение');
    });

    pendingPayments[address] = { amount, crypto, timestamp: Date.now(), status: 'pending' };
}

        function showRegistrationModal() {
            document.getElementById('registrationModal').style.display = 'flex';
        }

        function hideRegistrationModal() {
            document.getElementById('registrationModal').style.display = 'none';
        }

        function registerUser() {
            const t = translations[userLanguage];
            const nickname = document.getElementById('regNickname').value.trim();
            userLanguage = document.getElementById('regLanguage').value;

            if (!nickname) {
                document.getElementById('regError').textContent = t.regErrorEmpty;
                return;
            }

            if (registeredUsers.some(user => user.nickname === nickname)) {
                document.getElementById('regError').textContent = t.regErrorTaken;
                return;
            }

            currentUser = { nickname, language: userLanguage };
            registeredUsers.push(currentUser);
            localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            hideRegistrationModal();
            updateUI();
            showCustomModal(t.welcomeMessage.replace('{user}', nickname));
            sendRegistrationToAdmin(nickname);
        }

        function showCustomModal(message) {
            const t = translations[userLanguage];
            document.getElementById('customContent').innerHTML = `
                <h2>${t.alertTitle}</h2>
                <p>${message}</p>
                <button class="buy-button" onclick="closeModal('customModal')">${t.close}</button>
            `;
            document.getElementById('customModal').style.display = 'flex';
        }

        function showConfirmModal(message, onConfirm, onCancel) {
            const t = translations[userLanguage];
            document.getElementById('confirmContent').innerHTML = `
                <h2>${t.confirmTitle}</h2>
                <p>${message}</p>
                <button class="buy-button" onclick="confirmAction()">${t.yes}</button>
                <button class="buy-button" onclick="cancelAction()">${t.no}</button>
            `;
            document.getElementById('confirmModal').style.display = 'flex';

            window.confirmAction = () => {
                onConfirm();
                closeModal('confirmModal');
            };
            window.cancelAction = () => {
                onCancel();
                closeModal('confirmModal');
            };
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function updateOrderHistory() {
            const t = translations[userLanguage];
            const orderList = document.getElementById('orderList');
            orderList.innerHTML = orderHistory.length === 0 ? `<p>${t.orderListEmpty}</p>` : '';
            orderHistory.slice(-5).reverse().forEach(order => {
                orderList.innerHTML += `
                    <div class="product-card">
                        <h3>${order.product} (${order.weight} г)</h3>
                        <p>${order.price} ฿</p>
                        <p>${order.date}</p>
                        ${order.isPreorder ? '<p>Предзаказ</p>' : ''}
                    </div>`;
            });
        }

        function updateMail() {
            const t = translations[userLanguage];
            const mailList = document.getElementById('mailList');
            mailList.innerHTML = mailMessages.length === 0 ? `<p>${t.mailListEmpty}</p>` : '';
            mailMessages.forEach(msg => {
                mailList.innerHTML += `
                    <div class="product-card">
                        <h3>${msg.title}</h3>
                        <p>${msg.text}</p>
                        <p>${msg.date}</p>
                    </div>`;
            });
        }

        function applyForJob(job) {
            const t = translations[userLanguage];
            showInputModal(t.applyJobPrompt.replace('{job}', job), resume => {
                const message = t.applyJobSent.replace('{job}', job);
                mailMessages.push({
                    title: t.applyJobAlert.replace('{job}', job),
                    text: `Резюме: ${resume}`,
                    date: new Date().toLocaleString()
                });
                updateMail();
                showCustomModal(message);
                sendJobApplicationToAdmin(job, resume);
            });
        }

        function showInputModal(message, callback) {
            const t = translations[userLanguage];
            document.getElementById('customContent').innerHTML = `
                <h2>${t.inputTitle}</h2>
                <p>${message}</p>
                <textarea id="inputText"></textarea>
                <button class="buy-button" onclick="submitInput()">${t.confirmButton}</button>
                <button class="buy-button" onclick="closeModal('customModal')">${t.cancelButton}</button>
            `;
            document.getElementById('customModal').style.display = 'flex';

            window.submitInput = () => {
                const input = document.getElementById('inputText').value.trim();
                if (input) {
                    callback(input);
                    closeModal('customModal');
                }
            };
        }

        function sendOrderToAdmin(order, coords, description) {
            const text = `Новый заказ!\nПользователь: ${currentUser.nickname}\nТовар: ${order.product} (${order.weight} г)\nГород: ${order.city}\nРайон: ${order.district}\nКоординаты: ${coords}\nОписание клада: ${description}\nСумма: ${order.price} ฿\nДата: ${order.date}`;
            sendToTelegram(text);
        }

        function sendPreorderToAdmin(order) {
            const text = `Новый предзаказ!\nПользователь: ${currentUser.nickname}\nТовар: ${order.product} (${order.weight} г)\nГород: ${order.city}\nРайон: ${order.district}\nСумма: ${order.price} ฿\nДата: ${order.date}`;
            sendToTelegram(text);
        }

        function sendDepositToAdmin(crypto, amount, address) {
            const text = `Новый депозит!\nПользователь: ${currentUser.nickname}\nКриптовалюта: ${crypto}\nСумма: ${amount} ฿\nАдрес: ${address}`;
            sendToTelegram(text);
        }

        function sendRegistrationToAdmin(nickname) {
            const text = `Новый пользователь!\nНикнейм: ${nickname}\nЯзык: ${userLanguage}`;
            sendToTelegram(text);
        }

        function sendJobApplicationToAdmin(job, resume) {
            const text = `Новая заявка на вакансию!\nПользователь: ${currentUser.nickname}\nВакансия: ${job}\nРезюме: ${resume}`;
            sendToTelegram(text);
        }

        function sendToTelegram(text) {
            const url = `https://api.telegram.org/bot${BOT_B_TOKEN}/sendMessage`;
            fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    chat_id: ADMIN_CHAT_ID,
                    text: text
                })
            }).catch(error => console.error('Ошибка отправки в Telegram:', error));
        }

        function showPromoDetails() {
            const t = translations[userLanguage];
            showCustomModal(t.promoBanner);
        }

        window.onload = initApp;
    </script>
</body>
</html>
